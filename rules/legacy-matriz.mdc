---
alwaysApply: false
---
# Matriz de Rastreabilidade - MigraÃ§Ã£o de Sistemas Legados

## ðŸ“‹ Objetivo

Estabelecer regras para criaÃ§Ã£o e manutenÃ§Ã£o de uma matriz de rastreabilidade que acompanha a migraÃ§Ã£o de programas legados para uma soluÃ§Ã£o moderna composta por backend (.NET Core) e frontend (React + TypeScript).

## ðŸ“Š Estrutura da Matriz

### Arquivo
- **Nome**: `MATRIZ_RASTREABILIDADE.csv`
- **LocalizaÃ§Ã£o**: Raiz do workspace
- **Formato**: CSV com separador `;` (ponto e vÃ­rgula)
- **Encoding**: UTF-8 com BOM

### Campos (Colunas)

```csv
Id;Tipo;Objeto_Pai;Tipo_Objeto_Pai;Descricao_Breve;Ref_Legado_Arquivo;Ref_Legado_Linhas;Desc_Abordagem;Ref_Doc_Abordagem;Ref_Doc_Linhas;Status_Documentacao;Status_Implementacao;Status_Teste_Unitario;Ref_Doc_AsIs;Ref_Doc_AsIs_Linhas
```

#### DescriÃ§Ã£o dos Campos

| Campo | Tipo | DescriÃ§Ã£o | Exemplo |
|-------|------|-----------|---------|
| `Id` | String | Identificador Ãºnico (formato: `TIPO-NNNN`) | `TELA-0001`, `FUNC-0042` |
| `Tipo` | Enum | Tipo do objeto rastreado | `TELA`, `OBJETO`, `FUNCAO_TELA`, `METODO`, `REGRA`, `ENTIDADE`, `CAMPO`, `QUERY` |
| `Objeto_Pai` | String | Nome do objeto pai (tela, funÃ§Ã£o, entidade...) | `VGFNA`, `fnCalculaTotal`, `TB_USUARIO` |
| `Tipo_Objeto_Pai` | Enum | Tipo do objeto pai | `TELA`, `METODO`, `ENTIDADE`, etc. |
| `Descricao_Breve` | String | DescriÃ§Ã£o do elemento (mÃ¡x. 200 caracteres) | `Valida CPF antes de salvar` |
| `Ref_Legado_Arquivo` | String | Caminho do arquivo legado | `_LEGADO/vgfna.esf` |
| `Ref_Legado_Linhas` | String | Linhas no cÃ³digo legado | `125-150`, `342` |
| `Desc_Abordagem` | String | Resumo da abordagem de migraÃ§Ã£o | `Migrar para UsuarioService.ValidarCPF()` |
| `Ref_Doc_Abordagem` | String | Documento com a abordagem detalhada (To-Be) | `VA2VA_TELAS_DOCUMENTACAO.md` |
| `Ref_Doc_Linhas` | String | Linhas no documento To-Be | `45-67` |
| `Status_Documentacao` | Enum | Status da documentaÃ§Ã£o (`NA`, `OK`, `NOK`) | `OK` |
| `Status_Implementacao` | Enum | Status da implementaÃ§Ã£o (`NA`, `OK`, `NOK`) | `NOK` |
| `Status_Teste_Unitario` | Enum | Status dos testes (`NA`, `OK`, `NOK`) | `NA` |
| `Ref_Doc_AsIs` | String | Documento com anÃ¡lise As-Is (situaÃ§Ã£o atual do legado) | `va2va_funcoes_regras_negocio.md` |
| `Ref_Doc_AsIs_Linhas` | String | Linhas no documento As-Is | `100-150` |

## ðŸ·ï¸ Tipos de Objetos

### TELA
- Representa uma tela/formulÃ¡rio completo do sistema legado
- **ID**: `TELA-NNNN`
- **Objeto_Pai**: vazio (nÃ£o tem pai)
- **Tipo_Objeto_Pai**: vazio
- **Campos preenchidos**: `Descricao_Breve`, `Ref_Legado_*`, todos os status

### OBJETO
- Representa um componente visual (botÃ£o, grid, campo, label)
- **ID**: `OBJ-NNNN`
- **Objeto_Pai**: nome da tela onde estÃ¡
- **Tipo_Objeto_Pai**: `TELA`
- **Campos preenchidos**: `Objeto_Pai`, `Tipo_Objeto_Pai`, `Descricao_Breve`, `Ref_Legado_*`, status

### FUNCAO_TELA
- Representa uma funÃ§Ã£o/evento associado a uma tela
- **ID**: `FTELA-NNNN`
- **Objeto_Pai**: nome da tela ou objeto que dispara
- **Tipo_Objeto_Pai**: `TELA` ou `OBJETO`
- **Campos preenchidos**: `Objeto_Pai`, `Tipo_Objeto_Pai`, `Descricao_Breve`, `Ref_Legado_*`, todos os status

### METODO
- Representa uma funÃ§Ã£o/procedure/mÃ©todo do cÃ³digo legado
- **ID**: `METOD-NNNN`
- **Objeto_Pai**: vazio (se global) ou nome da classe/mÃ³dulo
- **Tipo_Objeto_Pai**: vazio ou tipo do container
- **Campos preenchidos**: `Descricao_Breve`, `Ref_Legado_*`, todos os status

### REGRA
- Representa uma regra de negÃ³cio (condicional, laÃ§o, transformaÃ§Ã£o, etc.)
- **ID**: `REGRA-NNNN`
- **Objeto_Pai**: nome do mÃ©todo onde estÃ¡
- **Tipo_Objeto_Pai**: `METODO` ou `FUNCAO_TELA`
- **Campos preenchidos**: `Objeto_Pai`, `Tipo_Objeto_Pai`, `Descricao_Breve`, `Ref_Legado_*`, todos os status
- **Formato DescriÃ§Ã£o**: `[SUBTIPO]: [Detalhes]`
- **Subtipos**:
  - `CALL`: Chamada a outra funÃ§Ã£o/procedure
  - `CONDICIONAL`: IF, CASE, SWITCH
  - `LACO`: FOR, WHILE, LOOP
  - `TRANSFORMACAO`: CÃ¡lculos, conversÃµes, formataÃ§Ãµes
  - `ATRIBUICAO`: Passagem de valores, atribuiÃ§Ãµes

### QUERY
- Representa uma operaÃ§Ã£o SQL no cÃ³digo legado
- **ID**: `QUERY-NNNN`
- **Objeto_Pai**: nome do mÃ©todo onde estÃ¡
- **Tipo_Objeto_Pai**: `METODO` ou `FUNCAO_TELA`
- **Campos preenchidos**: `Objeto_Pai`, `Tipo_Objeto_Pai`, `Descricao_Breve`, `Ref_Legado_*`, todos os status
- **Formato DescriÃ§Ã£o**: `[TIPO_SQL]: [Tabela] - [Detalhes]`
- **Tipos SQL**:
  - `SELECT`: Consulta de dados
  - `INSERT`: InserÃ§Ã£o de dados
  - `UPDATE`: AtualizaÃ§Ã£o de dados
  - `DELETE`: ExclusÃ£o de dados
  - `EXEC`: ExecuÃ§Ã£o de stored procedure
  - `MERGE`: OperaÃ§Ã£o de merge/upsert

### ENTIDADE
- Representa uma tabela, view ou entidade de dados
- **ID**: `ENT-NNNN`
- **Objeto_Pai**: vazio (ou schema/database)
- **Tipo_Objeto_Pai**: vazio (ou `SCHEMA`)
- **Campos preenchidos**: `Descricao_Breve`, `Ref_Legado_*`, todos os status

### CAMPO
- Representa um campo/coluna de uma entidade
- **ID**: `CAMPO-NNNN`
- **Objeto_Pai**: nome da entidade/tabela
- **Tipo_Objeto_Pai**: `ENTIDADE`
- **Campos preenchidos**: `Objeto_Pai`, `Tipo_Objeto_Pai`, `Descricao_Breve`, `Ref_Legado_*`

## ðŸ”¢ Sistema de IDs

### Formato
- PadrÃ£o: `[PREFIXO]-[NÃšMERO]`
- NÃºmero: 4 dÃ­gitos com zero Ã  esquerda (0001-9999)
- Exemplos: `TELA-0001`, `REGRA-0123`, `ENT-0042`, `QUERY-0056`

### Prefixos

| Tipo | Prefixo | Faixa |
|------|---------|-------|
| TELA | `TELA-` | 0001-0999 |
| OBJETO | `OBJ-` | 0001-4999 |
| FUNCAO_TELA | `FTELA-` | 0001-4999 |
| METODO | `METOD-` | 0001-2999 |
| REGRA | `REGRA-` | 0001-9999 |
| QUERY | `QUERY-` | 0001-9999 |
| ENTIDADE | `ENT-` | 0001-0999 |
| CAMPO | `CAMPO-` | 0001-9999 |

### Regras de Unicidade
- **NUNCA** duplicar IDs
- **SEMPRE** verificar o Ãºltimo ID usado antes de criar um novo
- IDs sÃ£o sequenciais dentro de cada tipo
- IDs deletados **NÃƒO** sÃ£o reutilizados

## ðŸ“ Status

### Valores Permitidos

| Status | Significado | Quando Usar |
|--------|-------------|-------------|
| `NA` | NÃ£o AplicÃ¡vel | Quando o campo nÃ£o faz sentido para aquele tipo de objeto |
| `OK` | ConcluÃ­do/Aprovado | Quando a fase estÃ¡ completa e validada |
| `NOK` | Pendente/NÃ£o ConcluÃ­do | Quando a fase nÃ£o foi iniciada ou estÃ¡ incompleta |

### Status por Tipo

#### Status_Documentacao
- `OK`: Elemento estÃ¡ documentado com descriÃ§Ã£o e abordagem clara
- `NOK`: Elemento identificado mas sem documentaÃ§Ã£o completa
- `NA`: Elementos de baixo nÃ­vel que nÃ£o requerem documentaÃ§Ã£o (ex: campos simples)

#### Status_Implementacao
- `OK`: CÃ³digo moderno implementado e funcionando
- `NOK`: Ainda nÃ£o implementado ou implementaÃ§Ã£o incompleta
- `NA`: Elementos que nÃ£o requerem implementaÃ§Ã£o (ex: documentaÃ§Ã£o de contexto)

#### Status_Teste_Unitario
- `OK`: Testes unitÃ¡rios escritos e passando
- `NOK`: Sem testes ou testes falhando
- `NA`: Elementos que nÃ£o sÃ£o testÃ¡veis unitariamente (ex: telas, objetos visuais)

## ðŸ”„ Processo de Rastreamento

### 1. AnÃ¡lise do CÃ³digo Legado

Quando analisar um arquivo legado, identificar e registrar:

#### Telas/FormulÃ¡rios
```csv
TELA-0001;TELA;;;Tela principal de gestÃ£o financeira;_LEGADO/vgfna.esf;1-50;;;NOK;NOK;NA;;
```

#### Objetos de Tela
```csv
OBJ-0001;OBJETO;VGFNA;TELA;BotÃ£o para incluir novo registro;_LEGADO/vgfna.esf;125;;;NOK;NOK;NA;;
OBJ-0002;OBJETO;VGFNA;TELA;Grid principal de listagem;_LEGADO/vgfna.esf;150-200;;;NOK;NOK;NA;;
```

#### FunÃ§Ãµes de Tela
```csv
FTELA-0001;FUNCAO_TELA;BTN_Incluir;OBJETO;Evento de clique do botÃ£o incluir;_LEGADO/vgfna.esf;126-145;;;NOK;NOK;NOK;;
```

#### MÃ©todos/Procedures
```csv
METOD-0001;METODO;;;Calcula o total dos valores;_LEGADO/vgfna.esf;500-550;;;NOK;NOK;NOK;va2va_funcoes_regras_negocio.md;120-145
```

#### Regras de NegÃ³cio
```csv
REGRA-0001;REGRA;fnCalculaTotal;METODO;CALL: fnValidaValor - Valida valor antes de calcular;_LEGADO/vgfna.esf;505;;;NOK;NOK;NOK;va2va_funcoes_regras_negocio.md;200-205
REGRA-0002;REGRA;fnCalculaTotal;METODO;CONDICIONAL: valor>0 - Valida se valor Ã© positivo;_LEGADO/vgfna.esf;510;;;NOK;NOK;NOK;va2va_funcoes_regras_negocio.md;206-210
REGRA-0003;REGRA;fnCalculaTotal;METODO;LACO: FOR - Itera sobre itens para somar;_LEGADO/vgfna.esf;515-530;;;NOK;NOK;NOK;va2va_funcoes_regras_negocio.md;211-220
REGRA-0004;REGRA;fnCalculaTotal;METODO;TRANSFORMACAO: SUM - Soma valores dos itens;_LEGADO/vgfna.esf;520;;;NOK;NOK;NOK;va2va_funcoes_regras_negocio.md;221-225
```

#### Queries SQL
```csv
QUERY-0001;QUERY;fnListaUsuarios;METODO;SELECT: TB_USUARIO - Busca usuÃ¡rios ativos ordenados por nome;_LEGADO/vgfna.esf;1200-1205;;;NOK;NOK;NOK;va2va_funcoes_regras_negocio.md;300-310
QUERY-0002;QUERY;fnInsereUsuario;METODO;INSERT: TB_USUARIO (NOME, EMAIL, CPF) - Insere novo usuÃ¡rio;_LEGADO/vgfna.esf;1500-1505;;;NOK;NOK;NOK;va2va_funcoes_regras_negocio.md;350-360
QUERY-0003;QUERY;fnAtualizaUsuario;METODO;UPDATE: TB_USUARIO SET NOME, EMAIL - Atualiza dados do usuÃ¡rio;_LEGADO/vgfna.esf;1600-1605;;;NOK;NOK;NOK;va2va_funcoes_regras_negocio.md;370-380
```

#### Entidades e Campos
```csv
ENT-0001;ENTIDADE;;;Tabela principal financeira;_LEGADO/vgfna.esf;600;;;OK;OK;NA;;
CAMPO-0001;CAMPO;TB_FINANCEIRO;ENTIDADE;ID do registro financeiro;_LEGADO/vgfna.esf;600;;;OK;OK;NA;;
CAMPO-0002;CAMPO;TB_FINANCEIRO;ENTIDADE;Valor do registro;_LEGADO/vgfna.esf;601;;;OK;OK;NA;;
```

### 2. DocumentaÃ§Ã£o da Abordagem

Quando documentar a abordagem de migraÃ§Ã£o:
- Atualizar `Ref_Doc_AsIs` com arquivo de documentaÃ§Ã£o As-Is (anÃ¡lise do legado)
- Atualizar `Ref_Doc_AsIs_Linhas` com linhas relevantes no documento As-Is
- Atualizar `Desc_Abordagem` com resumo da estratÃ©gia
- Atualizar `Ref_Doc_Abordagem` com o arquivo de documentaÃ§Ã£o To-Be (soluÃ§Ã£o)
- Atualizar `Ref_Doc_Linhas` com as linhas relevantes no documento To-Be
- Atualizar `Status_Documentacao` para `OK`

```csv
FTELA-0001;FUNCAO_TELA;BTN_Incluir;OBJETO;Evento de clique do botÃ£o incluir;_LEGADO/vgfna.esf;126-145;Migrar para Controller POST /Financeiro/incluir;VA2VA_TELAS_DOCUMENTACAO.md;45-67;OK;NOK;NOK;va2va_funcoes_regras_negocio.md;100-120
```

### 3. ImplementaÃ§Ã£o

Quando implementar a soluÃ§Ã£o moderna:
- Atualizar `Status_Implementacao` para `OK`
- Adicionar referÃªncia ao cÃ³digo implementado em `Desc_Abordagem`

```csv
FTELA-0001;FUNCAO_TELA;BTN_Incluir;OBJETO;Evento de clique do botÃ£o incluir;_LEGADO/vgfna.esf;126-145;Implementado em FinanceiroController.Incluir() + useCreateFinanceiro hook;VA2VA_TELAS_DOCUMENTACAO.md;45-67;OK;OK;NOK;va2va_funcoes_regras_negocio.md;100-120
```

### 4. Testes UnitÃ¡rios

Quando criar testes:
- Atualizar `Status_Teste_Unitario` para `OK` (ou `NA` se nÃ£o aplicÃ¡vel)

```csv
METOD-0001;METODO;;;Calcula o total dos valores;_LEGADO/vgfna.esf;500-550;FinanceiroViewModel.CalcularTotal() com testes em FinanceiroViewModelTests.cs;va2va_funcoes_regras_negocio.md;120-145;OK;OK;OK;va2va_funcoes_regras_negocio.md;80-119
```

## ðŸ“š DocumentaÃ§Ã£o As-Is vs To-Be

A matriz rastreia **dois tipos** de documentaÃ§Ã£o:

### Documento As-Is (SituaÃ§Ã£o Atual)
- **Campos**: `Ref_Doc_AsIs`, `Ref_Doc_AsIs_Linhas`
- **PropÃ³sito**: DocumentaÃ§Ã£o da anÃ¡lise do sistema legado (como estÃ¡)
- **ConteÃºdo**: 
  - AnÃ¡lise detalhada do cÃ³digo legado
  - Fluxos e comportamentos atuais
  - Regras de negÃ³cio identificadas
  - DependÃªncias e relacionamentos
- **Exemplo**: `va2va_funcoes_regras_negocio.md`

### Documento To-Be (SoluÃ§Ã£o Futura)
- **Campos**: `Ref_Doc_Abordagem`, `Ref_Doc_Linhas`
- **PropÃ³sito**: DocumentaÃ§Ã£o da soluÃ§Ã£o moderna (como serÃ¡)
- **ConteÃºdo**:
  - EspecificaÃ§Ã£o da arquitetura moderna
  - Mapeamento legado â†’ moderno
  - DecisÃµes de design
  - ImplementaÃ§Ã£o proposta
- **Exemplo**: `VA2VA_TELAS_DOCUMENTACAO.md`, `migration/backend/04_BUSINESS_LOGIC.md`

### RelaÃ§Ã£o entre As-Is e To-Be

```
CÃ³digo Legado (vgfna.esf)
    â†“
Doc As-Is (anÃ¡lise) â”€â”€â†’ Ref_Doc_AsIs
    â†“
Mapeamento/Gap Analysis
    â†“
Doc To-Be (soluÃ§Ã£o) â”€â”€â†’ Ref_Doc_Abordagem
    â†“
ImplementaÃ§Ã£o Moderna
```

## ðŸ”— Hierarquia e Relacionamentos

### Estrutura HierÃ¡rquica

A matriz representa uma estrutura hierÃ¡rquica atravÃ©s dos campos `Objeto_Pai` e `Tipo_Objeto_Pai`:

```
TELA (sem pai)
  â”œâ”€â”€ OBJETO (pai: TELA)
  â”‚   â””â”€â”€ FUNCAO_TELA (pai: OBJETO)
  â”‚       â”œâ”€â”€ REGRA (pai: FUNCAO_TELA)
  â”‚       â””â”€â”€ QUERY (pai: FUNCAO_TELA)
  â””â”€â”€ FUNCAO_TELA (pai: TELA)
      â”œâ”€â”€ REGRA (pai: FUNCAO_TELA)
      â””â”€â”€ QUERY (pai: FUNCAO_TELA)

METODO (sem pai ou pai: MÃ“DULO)
  â”œâ”€â”€ REGRA (pai: METODO)
  â””â”€â”€ QUERY (pai: METODO)

ENTIDADE (sem pai)
  â””â”€â”€ CAMPO (pai: ENTIDADE)
```

### Exemplo de Rastreamento HierÃ¡rquico

```csv
TELA-0001;TELA;;;Tela principal de gestÃ£o financeira;_LEGADO/vgfna.esf;1-50;;;OK;NOK;NA;VA2VA_TELAS_DOCUMENTACAO.md;10-40
OBJ-0001;OBJETO;VGFNA;TELA;BotÃ£o incluir novo registro;_LEGADO/vgfna.esf;125;;;OK;NOK;NA;VA2VA_TELAS_DOCUMENTACAO.md;45-50
FTELA-0001;FUNCAO_TELA;BTN_Incluir;OBJETO;Evento clique botÃ£o incluir;_LEGADO/vgfna.esf;126-145;;;OK;NOK;NOK;va2va_funcoes_regras_negocio.md;60-80
REGRA-0001;REGRA;OnIncluir;FUNCAO_TELA;CALL: fnValidaUsuario - Valida usuÃ¡rio antes de incluir;_LEGADO/vgfna.esf;130;;;OK;NOK;NOK;va2va_funcoes_regras_negocio.md;85-90
QUERY-0001;QUERY;OnIncluir;FUNCAO_TELA;INSERT: TB_USUARIO - Insere novo usuÃ¡rio no banco;_LEGADO/vgfna.esf;135;;;OK;NOK;NOK;va2va_funcoes_regras_negocio.md;95-105
```

Neste exemplo:
- A tela `VGFNA` nÃ£o tem pai
- O botÃ£o `BTN_Incluir` pertence Ã  tela `VGFNA`
- A funÃ§Ã£o `OnIncluir` pertence ao botÃ£o `BTN_Incluir`
- Uma regra e uma query pertencem Ã  funÃ§Ã£o `OnIncluir`

## ðŸš¨ Regras CrÃ­ticas

### NUNCA:
- âŒ Criar IDs duplicados
- âŒ Pular elementos do cÃ³digo legado
- âŒ Atualizar a matriz sem autorizaÃ§Ã£o do usuÃ¡rio
- âŒ Usar vÃ­rgula como separador (usar `;`)
- âŒ Deixar campos obrigatÃ³rios vazios
- âŒ Misturar conceitos em uma Ãºnica linha
- âŒ Esquecer de preencher `Objeto_Pai` quando aplicÃ¡vel

### SEMPRE:
- âœ… Verificar o Ãºltimo ID antes de criar um novo
- âœ… Preencher `Objeto_Pai` e `Tipo_Objeto_Pai` para manter hierarquia
- âœ… Usar formato de referÃªncia consistente (arquivo:linhas)
- âœ… Manter descriÃ§Ãµes concisas (mÃ¡x. 200 caracteres)
- âœ… Usar prefixo no inÃ­cio da descriÃ§Ã£o para REGRA e QUERY (CALL:, SELECT:, etc.)
- âœ… Preencher `Ref_Doc_AsIs` quando houver documentaÃ§Ã£o de anÃ¡lise do legado
- âœ… Preencher `Ref_Doc_Abordagem` quando houver documentaÃ§Ã£o da soluÃ§Ã£o moderna
- âœ… Verificar completude apÃ³s anÃ¡lise de arquivo legado
- âœ… Perguntar ao usuÃ¡rio antes de atualizar a matriz

## ðŸ“Š Garantia de Completude

### Checklist por Arquivo Legado

Ao finalizar anÃ¡lise de um arquivo, verificar:

- [ ] Todas as telas/formulÃ¡rios identificadas e registradas
- [ ] Todos os objetos visuais relevantes registrados
- [ ] Todas as funÃ§Ãµes/eventos de tela registrados
- [ ] Todas as funÃ§Ãµes/procedures/mÃ©todos registrados
- [ ] Todas as regras de negÃ³cio (calls, condicionais, laÃ§os, transformaÃ§Ãµes) registradas
- [ ] Todas as queries SQL (SELECT, INSERT, UPDATE, DELETE, EXEC) registradas
- [ ] Todas as entidades de dados identificadas
- [ ] Campos relevantes das entidades registrados
- [ ] Hierarquia (Objeto_Pai) preenchida corretamente
- [ ] Nenhum ID duplicado
- [ ] Todos os status preenchidos corretamente
- [ ] `Ref_Doc_AsIs` preenchido quando existe anÃ¡lise documentada do legado
- [ ] `Ref_Doc_Abordagem` preenchido quando existe documentaÃ§Ã£o da soluÃ§Ã£o

### ValidaÃ§Ã£o de Integridade

Antes de considerar um arquivo completo:

1. **Contagem de elementos**: Comparar com anÃ¡lise manual
2. **Cobertura de linhas**: Verificar se todas as Ã¡reas do cÃ³digo foram cobertas
3. **Relacionamentos**: Verificar se `Objeto_Pai` referencia objetos existentes
4. **Hierarquia**: Validar se a hierarquia faz sentido lÃ³gico
5. **ReferÃªncias**: Validar se todas as referÃªncias de arquivo/linhas estÃ£o corretas

## ðŸ”§ Comandos e OperaÃ§Ãµes

### Criar Nova Matriz
```bash
# Criar arquivo com header atualizado
echo "Id;Tipo;Objeto_Pai;Tipo_Objeto_Pai;Descricao_Breve;Ref_Legado_Arquivo;Ref_Legado_Linhas;Desc_Abordagem;Ref_Doc_Abordagem;Ref_Doc_Linhas;Status_Documentacao;Status_Implementacao;Status_Teste_Unitario;Ref_Doc_AsIs;Ref_Doc_AsIs_Linhas" > MATRIZ_RASTREABILIDADE.csv
```

### Obter PrÃ³ximo ID
```bash
# Sempre ler a matriz inteira e identificar o maior ID para cada tipo
# Incrementar +1 para o prÃ³ximo
```

### Adicionar Entrada
```csv
# Sempre adicionar no final do arquivo
# Sempre validar unicidade do ID antes
# Sempre verificar se Objeto_Pai existe (quando aplicÃ¡vel)
```

## ðŸ“ˆ RelatÃ³rios e MÃ©tricas

### MÃ©tricas de Progresso

Calcular periodicamente:

```
% DocumentaÃ§Ã£o = (Count(Status_Documentacao='OK') / Count(Status_Documentacao!='NA')) * 100
% ImplementaÃ§Ã£o = (Count(Status_Implementacao='OK') / Count(Status_Implementacao!='NA')) * 100
% Testes = (Count(Status_Teste_Unitario='OK') / Count(Status_Teste_Unitario!='NA')) * 100
% Geral = MÃ©dia das trÃªs mÃ©tricas acima
```

### RelatÃ³rio de PendÃªncias

Itens NOK por tipo:
```
SELECT Tipo, COUNT(*) 
FROM matriz 
WHERE Status_Documentacao='NOK' OR Status_Implementacao='NOK' OR Status_Teste_Unitario='NOK'
GROUP BY Tipo
```

### AnÃ¡lise de Hierarquia

Verificar elementos Ã³rfÃ£os (sem pai quando deveriam ter):
```
SELECT Id, Tipo, Descricao_Breve
FROM matriz
WHERE Tipo IN ('OBJETO', 'FUNCAO_TELA', 'REGRA', 'QUERY', 'CAMPO')
  AND (Objeto_Pai IS NULL OR Objeto_Pai = '')
```

## ðŸ¤ InteraÃ§Ã£o com o UsuÃ¡rio

### Antes de Atualizar a Matriz

**SEMPRE** perguntar:
```
Deseja atualizar a MATRIZ_RASTREABILIDADE.csv com as seguintes entradas:
- [ID]: [DescriÃ§Ã£o] (pai: [Objeto_Pai])
- [ID]: [DescriÃ§Ã£o] (pai: [Objeto_Pai])
...

Total: N entradas
  - Telas: N
  - Objetos: N
  - FunÃ§Ãµes: N
  - MÃ©todos: N
  - Regras: N
  - Queries: N
  - Entidades: N
  - Campos: N

Confirma? (s/n)
```

### Ao Detectar Duplicatas

**SEMPRE** alertar:
```
âš ï¸ AVISO: ID [ID] jÃ¡ existe na matriz!
- Entrada existente: [DescriÃ§Ã£o da entrada existente]
- Nova entrada: [DescriÃ§Ã£o da nova entrada]

AÃ§Ãµes possÃ­veis:
1. Gerar novo ID
2. Atualizar entrada existente
3. Cancelar operaÃ§Ã£o

Qual aÃ§Ã£o deseja realizar?
```

### Ao Detectar Pai Inexistente

**SEMPRE** alertar:
```
âš ï¸ AVISO: Objeto_Pai [NOME] nÃ£o encontrado na matriz!
- Entrada: [ID] - [DescriÃ§Ã£o]
- Tipo esperado do pai: [Tipo_Objeto_Pai]

AÃ§Ãµes possÃ­veis:
1. Criar objeto pai primeiro
2. Corrigir nome do objeto pai
3. Cancelar operaÃ§Ã£o

Qual aÃ§Ã£o deseja realizar?
```

### Ao Finalizar AnÃ¡lise de Arquivo

**SEMPRE** apresentar resumo:
```
âœ… AnÃ¡lise do arquivo [arquivo] concluÃ­da!

Resumo:
- Telas: N
- Objetos: N
- FunÃ§Ãµes de Tela: N
- MÃ©todos: N
- Regras de NegÃ³cio: N
- Queries SQL: N
  - SELECT: N
  - INSERT: N
  - UPDATE: N
  - DELETE: N
- Entidades: N
- Campos: N

Total de entradas: N

Hierarquia validada: [SIM/NÃƒO]
Elementos Ã³rfÃ£os detectados: N

Deseja adicionar estas entradas Ã  matriz? (s/n)
```

## ðŸŽ¯ Exemplo Completo

```csv
Id;Tipo;Objeto_Pai;Tipo_Objeto_Pai;Descricao_Breve;Ref_Legado_Arquivo;Ref_Legado_Linhas;Desc_Abordagem;Ref_Doc_Abordagem;Ref_Doc_Linhas;Status_Documentacao;Status_Implementacao;Status_Teste_Unitario;Ref_Doc_AsIs;Ref_Doc_AsIs_Linhas
TELA-0001;TELA;;;Tela principal de gestÃ£o financeira;_LEGADO/vgfna.esf;1-50;Migrar para mÃ³dulo Financeiro com CRUD completo;VA2VA_TELAS_DOCUMENTACAO.md;1-45;OK;NOK;NA;VA2VA_TELAS_DOCUMENTACAO.md;1-30
OBJ-0001;OBJETO;VGFNA;TELA;BotÃ£o incluir novo registro;_LEGADO/vgfna.esf;125;BotÃ£o React com shadcn/ui;VA2VA_TELAS_DOCUMENTACAO.md;50-55;OK;OK;NA;VA2VA_TELAS_DOCUMENTACAO.md;35-40
FTELA-0001;FUNCAO_TELA;BTN_Incluir;OBJETO;Evento clique botÃ£o incluir;_LEGADO/vgfna.esf;126-145;POST /Financeiro/incluir + useCreateFinanceiro;VA2VA_TELAS_DOCUMENTACAO.md;56-78;OK;OK;OK;va2va_funcoes_regras_negocio.md;50-75
METOD-0001;METODO;;;Calcula total dos valores;_LEGADO/vgfna.esf;500-550;FinanceiroViewModel.CalcularTotal();va2va_funcoes_regras_negocio.md;100-150;OK;OK;OK;va2va_funcoes_regras_negocio.md;50-99
REGRA-0001;REGRA;fnCalculaTotal;METODO;CALL: fnValidaValor - Valida valor antes calcular;_LEGADO/vgfna.esf;505;ValidarValor() em CreateFinanceiroViewModel;va2va_funcoes_regras_negocio.md;105-110;OK;OK;OK;va2va_funcoes_regras_negocio.md;52-55
REGRA-0002;REGRA;fnCalculaTotal;METODO;CONDICIONAL: valor>0 - Valida valor positivo;_LEGADO/vgfna.esf;510;if (valor <= 0) throw new InvalidOperationException;va2va_funcoes_regras_negocio.md;111-115;OK;OK;OK;va2va_funcoes_regras_negocio.md;56-60
REGRA-0003;REGRA;fnCalculaTotal;METODO;LACO: FOR - Itera itens para somar;_LEGADO/vgfna.esf;515-530;LINQ Sum() ou loop foreach;va2va_funcoes_regras_negocio.md;116-125;OK;OK;OK;va2va_funcoes_regras_negocio.md;61-70
QUERY-0001;QUERY;fnListaFinanceiros;METODO;SELECT: TB_FINANCEIRO WHERE ATIVO=1 - Busca registros ativos;_LEGADO/vgfna.esf;600-605;FinanceiroRepository.GetAllActive(dataInicio) usando Dapper;va2va_funcoes_regras_negocio.md;160-175;OK;OK;OK;va2va_funcoes_regras_negocio.md;130-140
QUERY-0002;QUERY;fnInsereFinanceiro;METODO;INSERT: TB_FINANCEIRO (VALOR, DATA, DESCRICAO) - Insere registro;_LEGADO/vgfna.esf;700-705;FinanceiroRepository.Save() com OUTPUT INSERTED.ID;va2va_funcoes_regras_negocio.md;180-190;OK;OK;OK;va2va_funcoes_regras_negocio.md;145-155
ENT-0001;ENTIDADE;;;Tabela financeira principal;_LEGADO/vgfna.esf;50;Entidade Financeiro no Domain;VA2VA_TELAS_DOCUMENTACAO.md;200-210;OK;OK;NA;VA2VA_TELAS_DOCUMENTACAO.md;180-190
CAMPO-0001;CAMPO;TB_FINANCEIRO;ENTIDADE;ID registro financeiro;_LEGADO/vgfna.esf;51;Propriedade Id em Financeiro;VA2VA_TELAS_DOCUMENTACAO.md;205;OK;OK;NA;VA2VA_TELAS_DOCUMENTACAO.md;185
CAMPO-0002;CAMPO;TB_FINANCEIRO;ENTIDADE;Valor do registro;_LEGADO/vgfna.esf;52;Propriedade Valor (decimal) em Financeiro;VA2VA_TELAS_DOCUMENTACAO.md;206;OK;OK;NA;VA2VA_TELAS_DOCUMENTACAO.md;186
CAMPO-0003;CAMPO;TB_FINANCEIRO;ENTIDADE;Data do registro;_LEGADO/vgfna.esf;53;Propriedade Data (DateTime) em Financeiro;VA2VA_TELAS_DOCUMENTACAO.md;207;OK;OK;NA;VA2VA_TELAS_DOCUMENTACAO.md;187
```

## ðŸ“ Guia de Preenchimento dos Campos de DocumentaÃ§Ã£o

### Quando Preencher Ref_Doc_AsIs

Preencher quando existir documentaÃ§Ã£o de **anÃ¡lise do sistema legado**:

**Documentos As-Is tÃ­picos:**
- `va2va_funcoes_regras_negocio.md` - AnÃ¡lise de funÃ§Ãµes e regras
- `VA2VA_TELAS_DOCUMENTACAO.md` - AnÃ¡lise de telas e objetos
- Documentos de anÃ¡lise de fluxos legados
- DocumentaÃ§Ã£o de reverse engineering

**Exemplo:**
```csv
METOD-0001;METODO;;;CB2QP000 - Processo inicial;_LEGADO/cb2qa.esf;3655-3684;;;;;NOK;NOK;NOK;va2va_funcoes_regras_negocio.md;100-150
```

### Quando Preencher Ref_Doc_Abordagem

Preencher quando existir documentaÃ§Ã£o da **soluÃ§Ã£o moderna proposta**:

**Documentos To-Be tÃ­picos:**
- `migration/backend/01_DOMAIN_MODEL.md` - EspecificaÃ§Ã£o do domÃ­nio
- `migration/backend/04_BUSINESS_LOGIC.md` - ViewModels e regras
- `migration/backend/06_API_LAYER.md` - Controllers e endpoints
- Documentos de arquitetura da soluÃ§Ã£o

**Exemplo:**
```csv
METOD-0001;METODO;;;CB2QP000 - Processo inicial;_LEGADO/cb2qa.esf;3655-3684;Migrar para InitializeViewModel;migration/backend/04_BUSINESS_LOGIC.md;50-80;OK;NOK;NOK;va2va_funcoes_regras_negocio.md;100-150
```

### Fluxo de DocumentaÃ§Ã£o Completo

```
1. AnÃ¡lise Inicial (As-Is)
   â†“
   Preencher: Ref_Doc_AsIs, Ref_Doc_AsIs_Linhas
   Status_Documentacao = NOK

2. DocumentaÃ§Ã£o da SoluÃ§Ã£o (To-Be)
   â†“
   Preencher: Desc_Abordagem, Ref_Doc_Abordagem, Ref_Doc_Linhas
   Status_Documentacao = OK

3. ImplementaÃ§Ã£o
   â†“
   Atualizar: Desc_Abordagem (adicionar detalhes da implementaÃ§Ã£o)
   Status_Implementacao = OK

4. Testes
   â†“
   Status_Teste_Unitario = OK
```

---

**VersÃ£o**: 2.2  
**Ãšltima AtualizaÃ§Ã£o**: 2025-12-04  
**Changelog**: 
- v2.2: Alterado separador de vÃ­rgula (`,`) para ponto e vÃ­rgula (`;`) para facilitar uso de vÃ­rgulas em descriÃ§Ãµes
- v2.1: Adicionados campos Ref_Doc_AsIs e Ref_Doc_AsIs_Linhas para rastreamento de documentaÃ§Ã£o As-Is
- v2.0: Estrutura simplificada com hierarquia atravÃ©s de Objeto_Pai e Tipo_Objeto_Pai
