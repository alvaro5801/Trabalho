---
globs: ["docs/asis"]
alwaysApply: false
---
## 1. Telas, Campos e Comportamentos

### 1.1 Estrutura do Documento

**IMPORTANTE**: Antes de iniciar, consultar `MATRIZ_RASTREABILIDADE.csv` para identificar os IDs j√° cadastrados.

```markdown
# 01 - Telas e Interface AS-IS

## ‚ö†Ô∏è Refer√™ncia √† Matriz

**Arquivo da Matriz**: `MATRIZ_RASTREABILIDADE.csv`

Este documento referencia os seguintes tipos de ID:
- **TELA-NNNN**: Mapas/Telas 3270
- **OBJ-NNNN**: Campos de tela
- **FTELA-NNNN**: Fun√ß√µes de apresenta√ß√£o de tela
- **METOD-NNNN**: Fun√ß√µes que processam telas
- **REGRA-NNNN**: Regras de valida√ß√£o e comportamento
- **ENT-NNNN**: Estruturas de dados usadas

## Invent√°rio de Telas

### Comando de Extra√ß√£o
```bash
.\vamap.exe _LEGADO/<programa>.esf --map
```

### Lista de Mapas Identificados

**Fonte da Matriz**: Consultar IDs em `MATRIZ_RASTREABILIDADE.csv` onde `Tipo='TELA'`

| ID Matriz | Nome Mapa | Descri√ß√£o | Fun√ß√£o que Abre | ID Fun√ß√£o | Arquivo Legado | Linha |
|-----------|-----------|-----------|-----------------|-----------|----------------|-------|
| TELA-0001 | CB2QM010 | Tela consulta movto debito automatico | CB2QP002 | METOD-0003 | _LEGADO/cb2qa.esf | 90 |
| TELA-0002 | CB2QM020 | Tela listagem resultados consulta | CB2QP005 | METOD-0004 | _LEGADO/cb2qa.esf | 590 |
| TELA-0003 | CB2QM030 | Tela detalhamento parcelas | CB2QP030 | METOD-0006 | _LEGADO/cb2qa.esf | 1452 |

## Detalhamento por Tela

### [TELA-0001] - CB2QM010 - Tela Consulta Movimento D√©bito Autom√°tico

**Rastreabilidade** (da `MATRIZ_RASTREABILIDADE.csv`):
- **ID Matriz**: `TELA-0001`
- **Descri√ß√£o**: CB2QM010 - Tela consulta movto debito automatico
- **Arquivo Legado**: `_LEGADO/cb2qa.esf`
- **Linha**: 90
- **Fun√ß√£o de Abertura**: CB2QP002 (ID: `METOD-0003`)

**Comando de Visualiza√ß√£o**:
```bash
.\vamap.exe _LEGADO/cb2qa.esf --map "CB2QM010"
```

**Layout Visual**:
```
[COLAR AQUI O OUTPUT COMPLETO DO COMANDO vamap --map]
```

**Mapeamento de Campos**:

**Fonte**: Consultar IDs em `MATRIZ_RASTREABILIDADE.csv` onde `Objeto_Pai='CB2QM010'` e `Tipo_Objeto_Pai='TELA'`

| ID Matriz | Campo Mapa | Label | Tipo | Tamanho | Edit√°vel | Foco Inicial | Linha Legado | Valida√ß√µes |
|-----------|------------|-------|------|---------|----------|--------------|--------------|------------|
| OBJ-0007 | NUM_TITULO | Numero titulo | String | - | Sim | Sim | 228 | Obrigat√≥rio (REGRA-0007) |
| OBJ-0008 | NUM_APOLICE | Numero apolice | String | - | Sim | N√£o | 314 | - |
| OBJ-0009 | NRENDOS | Numero endosso | String | - | Sim | N√£o | 343 | - |
| OBJ-0010 | COD_AGENCIA_DEB | Codigo agencia debito | String | - | Sim | N√£o | 407 | - |
| OBJ-0011 | OPER_CONTA_DEB | Operacao conta debito | String | - | Sim | N√£o | 429 | - |
| OBJ-0012 | NUM_CONTA_DEB | Numero conta debito | String | - | Sim | N√£o | 451 | - |
| OBJ-0013 | DIG_CONTA_DEB | Digito conta debito | String | - | Sim | N√£o | 473 | - |
| OBJ-0014 | WK_CARTAO1 | Numero cartao credito | String | - | Sim | N√£o | 524 | - |
| OBJ-0015 | DIG_NUM_CARTAO | Digito cartao | String | - | Sim | N√£o | 545 | - |
| OBJ-0016 | EZEMSG | Mensagem sistema | String | - | N√£o | N√£o | 566 | - |

**Teclas de Fun√ß√£o Habilitadas**:

**Fonte**: Consultar IDs em `MATRIZ_RASTREABILIDADE.csv` onde `Tipo='REGRA'` e fun√ß√£o referencia teclas

| Tecla | ID Matriz Regra | A√ß√£o | Fun√ß√£o Chamada | ID Fun√ß√£o |
|-------|-----------------|------|----------------|-----------|
| F3 | REGRA-0001 | Sair | ZZ01SGPS3 | METOD-0069 |
| F5 | REGRA-0005 | Limpar | (inline) | METOD-0003 |
| F12 | REGRA-0003 | Cancelar | ZZ01SGPS12 | METOD-0070 |

**Comportamentos da Tela**:

- **Inicializa√ß√£o** (ID: `REGRA-NNNN`):
  - Descri√ß√£o do que acontece ao abrir a tela
  - Campos pr√©-preenchidos
  - Valida√ß√µes iniciais

- **Valida√ß√µes de Entrada** (ID: `REGRA-NNNN`):
  - Regras de valida√ß√£o por campo
  - Mensagens de erro
  - Condi√ß√µes de habilita√ß√£o

- **Navega√ß√£o** (ID: `FTELA-NNNN`):
  - Fluxo entre telas
  - Condi√ß√µes de transi√ß√£o

**Fluxo de Navega√ß√£o**:

```mermaid
graph TD
    A[TELA-0001: CB2QM010<br/>Consulta] -->|F5 Consultar| B[TELA-0002: CB2QM020<br/>Resultado]
    B -->|F3 Voltar| A
    B -->|F12 Cancelar| C[Menu Principal]
    A -->|F3 Sair| C
```

**Estruturas de Dados Relacionadas**:

- `ENT-NNNN`: Nome da estrutura (input/output)
- `ENT-NNNN`: Nome do workstorage

**Regras de Neg√≥cio Aplicadas**:

- `REGRA-NNNN`: Descri√ß√£o da regra
- `REGRA-NNNN`: Descri√ß√£o da regra

**Mensagens de Usu√°rio**:

| C√≥digo | Tipo | Mensagem | Quando Exibida |
|--------|------|----------|----------------|
| E001 | Erro | Certificado inv√°lido | Campo vazio ou inexistente |
| W001 | Aviso | Registro n√£o encontrado | Consulta sem resultado |
| S001 | Sucesso | Opera√ß√£o realizada | Ap√≥s sucesso |
```

### 1.2 Comandos Obrigat√≥rios

Para **CADA** tela identificada, executar:

```bash
# 1. Listar todos os mapas
.\vamap.exe _LEGADO/<programa>.esf --map

# 2. Para cada mapa, obter visualiza√ß√£o completa
.\vamap.exe _LEGADO/<programa>.esf --map "<NOME_MAPA>"

# 3. Identificar fun√ß√£o que abre o mapa
.\vamap.exe _LEGADO/<programa>.esf --code "|" | grep -i "<NOME_MAPA>"

# 4. Ver c√≥digo da fun√ß√£o de abertura
.\vamap.exe _LEGADO/<programa>.esf --code "<FUNCAO_ABERTURA>"

# 5. Identificar intera√ß√µes com tela (CONVERSE)
.\vamap.exe _LEGADO/<programa>.esf --code ":converse"
```

### 1.3 Checklist de Documenta√ß√£o de Telas

- [ ] **OBRIGAT√ìRIO**: Listagem completa de mapas extra√≠da
- [ ] **OBRIGAT√ìRIO**: Cada tela tem ID na matriz (TELA-NNNN)
- [ ] **OBRIGAT√ìRIO**: Layout visual inclu√≠do (output vamap)
- [ ] **OBRIGAT√ìRIO**: Todos campos t√™m ID na matriz (OBJ-NNNN)
- [ ] **OBRIGAT√ìRIO**: Teclas de fun√ß√£o mapeadas (FTELA-NNNN)
- [ ] **OBRIGAT√ìRIO**: Fun√ß√µes de abertura identificadas (METOD-NNNN)
- [ ] Diagrama Mermaid de navega√ß√£o criado
- [ ] Comportamentos documentados
- [ ] Valida√ß√µes identificadas (REGRA-NNNN)
- [ ] Mensagens de usu√°rio catalogadas
- [ ] Estruturas de dados vinculadas (ENT-NNNN)

---

## 2. Modelo de Dados e Integra√ß√£o com Database

### 2.1 Estrutura do Documento

```markdown
# 02 - Modelo de Dados AS-IS

## Invent√°rio de Estruturas de Dados

### Comando de Extra√ß√£o
```bash
.\vamap.exe _LEGADO/<programa>.esf --code "\"
```

### Estruturas Identificadas

| ID Matriz | Nome Estrutura | Tipo | Organiza√ß√£o | Uso |
|-----------|----------------|------|-------------|-----|
| ENT-0001 | V1SISTEMA | FUNCTION | DB2 Table | Tabela de sistemas |
| ENT-0002 | CB2QW001 | RECORD | WORKSTOR | √Årea de trabalho |
| ENT-0003 | GE_MOVTO_CONTA | FUNCTION | DB2 Table | Tabela de movimentos |

## Tabelas DB2 (FUNCTION)

### [ENT-NNNN] - Nome da Tabela

**Rastreabilidade**:
- **ID Matriz**: `ENT-NNNN`
- **Nome Tabela**: `<NOME_TABELA>`
- **Tipo**: FUNCTION (DB2)
- **Arquivo**: `_LEGADO/<programa>.esf`

**Comando de Detalhamento**:
```bash
.\vamap.exe _LEGADO/<programa>.esf --code "<NOME_TABELA>\"
```

**Estrutura da Tabela**:

| ID Matriz | Campo | Tipo | Tamanho | Decimais | Nulo | Descri√ß√£o |
|-----------|-------|------|---------|----------|------|-----------|
| OBJ-NNNN | IDSISTEM | CHAR | 2 | 0 | N√£o | Identificador do sistema |
| OBJ-NNNN | NOMSISTEM | CHAR | 30 | 0 | N√£o | Nome do sistema |
| OBJ-NNNN | DATSISTEM | DATE | 10 | 0 | Sim | Data de cadastro |

**Output vamap**:
```
[COLAR AQUI O OUTPUT COMPLETO DO COMANDO vamap <TABELA>\]
```

**Opera√ß√µes SQL Identificadas**:

| ID Matriz | Tipo Opera√ß√£o | Fun√ß√£o | Descri√ß√£o |
|-----------|---------------|--------|-----------|
| QUERY-0001 | INQUIRY | CB2QP003 | SELECT √∫nico por IDSISTEM |
| QUERY-0002 | SETINQ | CB2QP005 | SELECT m√∫ltiplo com filtros |
| QUERY-0003 | INSERT | CB2QP010 | Inserir novo registro |
| QUERY-0004 | UPDATE | CB2QP012 | Atualizar registro existente |

**Relacionamentos**:

```mermaid
erDiagram
    V1SISTEMA ||--o{ GE_MOVTO_CONTA : "possui"
    V1SISTEMA {
        string IDSISTEM PK
        string NOMSISTEM
        date DATSISTEM
    }
    GE_MOVTO_CONTA {
        string NUM_APOLICE PK
        string NUM_ENDOSSO PK
        string IDSISTEM FK
        decimal VALOR
    }
```

**√çndices e Chaves**:

| Tipo | Campos | Descri√ß√£o |
|------|--------|-----------|
| PK | IDSISTEM | Chave prim√°ria |
| FK | IDSISTEM_REF | Chave estrangeira para tabela X |
| IDX | NOMSISTEM | √çndice para consulta por nome |

**Uso nas Telas**:

- `TELA-0001`: CB2QM010 (leitura)
- `TELA-0002`: CB2QM020 (escrita)

**Uso nas Fun√ß√µes**:

- `METOD-0011`: CB2QP003 (INQUIRY)
- `METOD-0015`: CB2QP005 (SETINQ/SCAN)

## Estruturas Internas (RECORD)

### [ENT-NNNN] - Nome do Record

**Rastreabilidade**:
- **ID Matriz**: `ENT-NNNN`
- **Nome Record**: `<NOME_RECORD>`
- **Tipo**: RECORD
- **Organiza√ß√£o**: WORKSTOR
- **Uso**: SHARED/NONSHARED

**Estrutura**:

| ID Matriz | Campo | Tipo | Tamanho | Occurs | Descri√ß√£o |
|-----------|-------|------|---------|--------|-----------|
| OBJ-NNNN | CAMPO1 | CHAR | 10 | - | Descri√ß√£o |
| OBJ-NNNN | CAMPO2 | ARRAY | 8 | 200 | Array de 200 elementos |

**Output vamap**:
```
[COLAR AQUI O OUTPUT COMPLETO DO COMANDO vamap <RECORD>\]
```

**Fun√ß√µes que Utilizam**:

- `METOD-0001`: CB2QP000 (leitura/escrita)
- `METOD-0005`: CB2QP002 (leitura)

## Mapeamento de Opera√ß√µes SQL

### Opera√ß√µes INQUIRY (SELECT √önico)

**Comando de Identifica√ß√£o**:
```bash
.\vamap.exe _LEGADO/<programa>.esf --code ":inquiry"
```

| ID Matriz | Fun√ß√£o | Tabela | Descri√ß√£o | Onde Usado |
|-----------|--------|--------|-----------|------------|
| QUERY-0001 | CB2QP003 | V1SISTEMA | SELECT por IDSISTEM | METOD-0011 |

### Opera√ß√µes SETINQ/SCAN (SELECT M√∫ltiplo)

**Comando de Identifica√ß√£o**:
```bash
.\vamap.exe _LEGADO/<programa>.esf --code ":setinq"
.\vamap.exe _LEGADO/<programa>.esf --code ":scan"
```

| ID Matriz | Fun√ß√£o SETINQ | Fun√ß√£o SCAN | Tabela | Descri√ß√£o |
|-----------|---------------|-------------|--------|-----------|
| QUERY-0002 | CB2QP005 | CB2QP006 | V1SISTEMA | Lista todos sistemas ativos |

### Opera√ß√µes INSERT

**Comando de Identifica√ß√£o**:
```bash
.\vamap.exe _LEGADO/<programa>.esf --code ":insert"
```

### Opera√ß√µes UPDATE

**Comando de Identifica√ß√£o**:
```bash
.\vamap.exe _LEGADO/<programa>.esf --code ":update"
```

### Opera√ß√µes DELETE

**Comando de Identifica√ß√£o**:
```bash
.\vamap.exe _LEGADO/<programa>.esf --code ":delete"
```

## Diagrama Entidade-Relacionamento Completo

```mermaid
erDiagram
    TABELA1 ||--o{ TABELA2 : "relacionamento"
    TABELA2 ||--o{ TABELA3 : "relacionamento"
    TABELA1 {
        string ID PK
        string CAMPO1
    }
    TABELA2 {
        string ID PK
        string TABELA1_ID FK
    }
```

## An√°lise de Integridade

**Constraints Identificadas**:
- Chaves prim√°rias
- Chaves estrangeiras
- Valida√ß√µes de campo
- Regras de neg√≥cio em procedures

**Transa√ß√µes Cr√≠ticas**:
- Opera√ß√µes que envolvem m√∫ltiplas tabelas
- Pontos de commit/rollback
```

### 2.2 Comandos Obrigat√≥rios

Para **CADA** estrutura de dados:

```bash
# 1. Listar todas as estruturas
.\vamap.exe _LEGADO/<programa>.esf --code "\"

# 2. Listar apenas tabelas DB2 (FUNCTION)
.\vamap.exe _LEGADO/<programa>.esf --code "\FUNCTION"

# 3. Listar apenas RECORDs
.\vamap.exe _LEGADO/<programa>.esf --code "\RECORD"

# 4. Listar workstorage
.\vamap.exe _LEGADO/<programa>.esf --code "\WORKSTOR"

# 5. Detalhar estrutura espec√≠fica
.\vamap.exe _LEGADO/<programa>.esf --code "<NOME_ESTRUTURA>\"

# 6. Identificar todas as opera√ß√µes SQL
.\vamap.exe _LEGADO/<programa>.esf --code ":inquiry"
.\vamap.exe _LEGADO/<programa>.esf --code ":setinq"
.\vamap.exe _LEGADO/<programa>.esf --code ":scan"
.\vamap.exe _LEGADO/<programa>.esf --code ":insert"
.\vamap.exe _LEGADO/<programa>.esf --code ":update"
.\vamap.exe _LEGADO/<programa>.esf --code ":delete"
.\vamap.exe _LEGADO/<programa>.esf --code ":execute"
```

### 2.3 Checklist de Documenta√ß√£o de Dados

- [ ] **OBRIGAT√ìRIO**: Invent√°rio completo de estruturas extra√≠do
- [ ] **OBRIGAT√ìRIO**: Cada estrutura tem ID na matriz (ENT-NNNN)
- [ ] **OBRIGAT√ìRIO**: Cada campo tem ID na matriz (OBJ-NNNN)
- [ ] **OBRIGAT√ìRIO**: Cada opera√ß√£o SQL tem ID (QUERY-NNNN)
- [ ] **OBRIGAT√ìRIO**: Output vamap inclu√≠do para cada estrutura
- [ ] Diagrama ER em Mermaid criado
- [ ] Tabelas DB2 identificadas (FUNCTION)
- [ ] Records internos documentados
- [ ] Workstorage mapeado
- [ ] Relacionamentos entre tabelas identificados
- [ ] √çndices e chaves documentados
- [ ] Opera√ß√µes INQUIRY mapeadas
- [ ] Opera√ß√µes SETINQ/SCAN mapeadas
- [ ] Opera√ß√µes INSERT/UPDATE/DELETE mapeadas
- [ ] Uso nas telas vinculado
- [ ] Uso nas fun√ß√µes vinculado

---

## 3. Fluxo de Execu√ß√£o

### 3.1 Estrutura do Documento

```markdown
# 03 - Fluxo de Execu√ß√£o AS-IS

## Vis√£o Geral do Stack

### Comando de Extra√ß√£o
```bash
.\vamap.exe _LEGADO/<programa>.esf --code "|"
```

**Stack Completo**:
```
[COLAR AQUI O OUTPUT COMPLETO DO COMANDO vamap |]
```

**Hierarquia de Fun√ß√µes**:

```mermaid
graph TD
    A[METOD-0001: CB2QP000<br/>Main Entry Point] --> B[METOD-0002: CB2QP001<br/>Loop Principal]
    B --> C[METOD-0003: CB2QP002<br/>Abrir Tela]
    B --> D[METOD-0004: CB2QP005<br/>Processar Consulta]
    D --> E[METOD-0011: CB2QP003<br/>INQUIRY Sistema]
    D --> F[METOD-0015: CB2QP010<br/>Validar Dados]
```

## Fluxo Principal de Execu√ß√£o

### 1. Inicializa√ß√£o (METOD-0001)

**Rastreabilidade**:
- **ID Matriz**: `METOD-0001`
- **Fun√ß√£o**: `<PROGRAMA>P000`
- **Tipo**: Main Entry Point
- **Arquivo**: `_LEGADO/<programa>.esf`
- **Linhas**: XXXX-YYYY

**Comando de Visualiza√ß√£o**:
```bash
.\vamap.exe _LEGADO/<programa>.esf --code "<PROGRAMA>P000"
```

**C√≥digo Extra√≠do**:
```
[COLAR AQUI O OUTPUT DO COMANDO]
```

**Descri√ß√£o**:
- Inicializa vari√°veis globais
- Carrega par√¢metros de execu√ß√£o
- Estabelece conex√£o com DB2
- Chama fun√ß√£o principal (P001)

**Fluxo**:

```mermaid
flowchart TD
    Start([In√≠cio]) --> Init[Inicializar Vari√°veis]
    Init --> Connect[Conectar DB2]
    Connect --> Call[Chamar P001]
    Call --> End([Fim])
```

**Chamado por**: Ningu√©m (entry point)

**Chama**:
- `METOD-0002`: CB2QP001 (loop principal)

**Estruturas Usadas**:
- `ENT-0001`: CB2QW001 (workstorage)

**Regras de Neg√≥cio**:
- `REGRA-0001`: Valida√ß√£o de conex√£o

### 2. Loop Principal (METOD-0002)

[Mesmo formato para cada fun√ß√£o importante]

## Fluxo por Caso de Uso

### Caso de Uso 1: Consulta de Certificado

**Rastreabilidade**:
- **ID Matriz Principal**: `METOD-0002`
- **Tela Inicial**: `TELA-0001` (CB2QM010)

**Fluxo Completo**:

```mermaid
sequenceDiagram
    participant U as Usu√°rio
    participant T1 as TELA-0001<br/>CB2QM010
    participant P2 as METOD-0003<br/>CB2QP002
    participant P3 as METOD-0011<br/>CB2QP003
    participant DB as Database

    U->>T1: Digita certificado
    U->>T1: Pressiona F5
    T1->>P2: CONVERSE
    P2->>P2: Validar entrada (REGRA-0007)
    P2->>P3: Consultar sistema
    P3->>DB: INQUIRY V1SISTEMA
    DB-->>P3: Retorna dados
    P3-->>P2: Resultado
    P2->>T1: Exibe na tela
    T1-->>U: Mostra resultado
```

**Passos Detalhados**:

1. **Exibir Tela de Consulta** (`METOD-0003`)
   - Abre mapa CB2QM010 (`TELA-0001`)
   - Aguarda entrada do usu√°rio
   
2. **Validar Entrada** (`REGRA-0007`)
   - Verifica campo NUM_CERTIFICADO (`OBJ-0007`)
   - Se vazio, exibe erro E001
   
3. **Consultar Database** (`QUERY-0001`)
   - Executa INQUIRY em V1SISTEMA (`ENT-0001`)
   - WHERE IDSISTEM = valor informado
   
4. **Processar Resultado** (`METOD-0015`)
   - Se encontrado, popula tela
   - Se n√£o encontrado, exibe mensagem W001

**Fun√ß√µes Envolvidas**:

| ID Matriz | Fun√ß√£o | Tipo | Descri√ß√£o |
|-----------|--------|------|-----------|
| METOD-0003 | CB2QP002 | CONVERSE | Abrir tela |
| REGRA-0007 | IF NUM_TITULO<>0 | Valida√ß√£o | Validar entrada |
| METOD-0011 | CB2QP003 | INQUIRY | Consultar DB |
| METOD-0015 | CB2QP010 | Business Logic | Processar resultado |

**Telas Envolvidas**:

- `TELA-0001`: CB2QM010 (entrada)
- `TELA-0002`: CB2QM020 (resultado)

**Dados Envolvidos**:

- `ENT-0001`: V1SISTEMA (tabela consultada)
- `ENT-0002`: CB2QW001 (workstorage)

### [Repetir para cada caso de uso identificado]

## An√°lise de Tipos de Fun√ß√£o

### Fun√ß√µes CONVERSE (Interface)

**Comando de Identifica√ß√£o**:
```bash
.\vamap.exe _LEGADO/<programa>.esf --code ":converse"
```

| ID Matriz | Fun√ß√£o | Mapa Associado | Descri√ß√£o |
|-----------|--------|----------------|-----------|
| METOD-0003 | CB2QP002 | CB2QM010 | Tela de consulta |

### Fun√ß√µes INQUIRY (Consultas √önicas)

**Comando de Identifica√ß√£o**:
```bash
.\vamap.exe _LEGADO/<programa>.esf --code ":inquiry"
```

### Fun√ß√µes EXECUTE (L√≥gica de Neg√≥cio)

**Comando de Identifica√ß√£o**:
```bash
.\vamap.exe _LEGADO/<programa>.esf --code ":execute"
```

## Matriz de Depend√™ncias

| Fun√ß√£o | Chamada Por | Chama | Usa Dados | Usa Telas |
|--------|-------------|-------|-----------|-----------|
| CB2QP000 | - | CB2QP001 | CB2QW001 | - |
| CB2QP001 | CB2QP000 | CB2QP002 | CB2QW001 | - |
| CB2QP002 | CB2QP001 | CB2QP003 | V1SISTEMA | CB2QM010 |

## Diagramas de Contexto

### Diagrama de Componentes

```mermaid
graph TB
    subgraph "Camada de Apresenta√ß√£o"
        T1[TELA-0001: CB2QM010]
        T2[TELA-0002: CB2QM020]
    end
    
    subgraph "Camada de Neg√≥cio"
        M1[METOD-0002: CB2QP001]
        M2[METOD-0003: CB2QP002]
        M3[METOD-0011: CB2QP003]
    end
    
    subgraph "Camada de Dados"
        E1[(ENT-0001: V1SISTEMA)]
        E2[(ENT-0003: GE_MOVTO_CONTA)]
    end
    
    T1 --> M2
    M2 --> M3
    M3 --> E1
    M3 --> E2
```
```

### 3.2 Comandos Obrigat√≥rios

Para an√°lise de fluxo completo:

```bash
# 1. Stack completo de execu√ß√£o
.\vamap.exe _LEGADO/<programa>.esf --code "|"

# 2. Para cada fun√ß√£o no stack, ver c√≥digo
.\vamap.exe _LEGADO/<programa>.esf --code "<NOME_FUNCAO>"

# 3. Para cada fun√ß√£o, ver quem chama
.\vamap.exe _LEGADO/<programa>.esf --code "@<NOME_FUNCAO>"

# 4. Para cada fun√ß√£o, ver posi√ß√£o no stack
.\vamap.exe _LEGADO/<programa>.esf --code "!<NOME_FUNCAO>"

# 5. Separar fun√ß√µes por tipo
.\vamap.exe _LEGADO/<programa>.esf --code ":inquiry"
.\vamap.exe _LEGADO/<programa>.esf --code ":converse"
.\vamap.exe _LEGADO/<programa>.esf --code ":execute"
.\vamap.exe _LEGADO/<programa>.esf --code ":insert"
.\vamap.exe _LEGADO/<programa>.esf --code ":update"

# 6. Usar comando de fluxo completo
# Consultar: @commands/vamap-flow.md
```

### 3.3 Checklist de Documenta√ß√£o de Fluxo

- [ ] **OBRIGAT√ìRIO**: Stack completo extra√≠do e inclu√≠do
- [ ] **OBRIGAT√ìRIO**: Cada fun√ß√£o tem ID na matriz (METOD-NNNN)
- [ ] **OBRIGAT√ìRIO**: C√≥digo extra√≠do para fun√ß√µes principais
- [ ] **OBRIGAT√ìRIO**: Diagrama de hierarquia em Mermaid
- [ ] Diagrama de sequ√™ncia por caso de uso
- [ ] Diagrama de componentes/camadas
- [ ] Fun√ß√µes separadas por tipo documentadas
- [ ] Matriz de depend√™ncias criada
- [ ] Relacionamento com telas documentado
- [ ] Relacionamento com dados documentado
- [ ] Chamadores identificados para cada fun√ß√£o
- [ ] Posi√ß√£o no stack documentada
- [ ] Fluxos de navega√ß√£o mapeados

---

## 4. Fun√ß√µes, Procedures, Calls e Regras de Neg√≥cio

### 4.1 Estrutura do Documento

```markdown
# 04 - Fun√ß√µes e Regras de Neg√≥cio AS-IS

## Invent√°rio de Fun√ß√µes

### Comando de Extra√ß√£o
```bash
.\vamap.exe _LEGADO/<programa>.esf --code "|"
```

**Fun√ß√µes Identificadas**:

| ID Matriz | Nome Fun√ß√£o | Tipo | Linha In√≠cio | Linha Fim | Complexidade |
|-----------|-------------|------|--------------|-----------|--------------|
| METOD-0001 | CB2QP000 | Main | 3655 | 3684 | Baixa |
| METOD-0002 | CB2QP001 | Loop | 3685 | 3750 | M√©dia |
| METOD-0011 | CB2QP003 | INQUIRY | 6274 | 6289 | Baixa |

## Detalhamento por Fun√ß√£o

### [METOD-NNNN] - Nome da Fun√ß√£o

**Rastreabilidade**:
- **ID Matriz**: `METOD-NNNN`
- **Nome**: `<PROGRAMA>PNNN`
- **Tipo**: INQUIRY / CONVERSE / EXECUTE / INSERT / UPDATE / DELETE
- **Arquivo**: `_LEGADO/<programa>.esf`
- **Linhas**: XXXX-YYYY

**Comando de Visualiza√ß√£o**:
```bash
.\vamap.exe _LEGADO/<programa>.esf --code "<PROGRAMA>PNNN"
```

**C√≥digo Fonte Completo**:
```
[COLAR AQUI O OUTPUT COMPLETO DO COMANDO vamap <FUNCAO>]
```

**Prop√≥sito**:
Descri√ß√£o clara do que a fun√ß√£o faz.

**Entrada (Par√¢metros)**:

| ID Matriz | Par√¢metro | Tipo | Obrigat√≥rio | Descri√ß√£o |
|-----------|-----------|------|-------------|-----------|
| OBJ-NNNN | NUM_CERTIFICADO | String | Sim | N√∫mero do certificado |

**Sa√≠da (Retorno)**:

| ID Matriz | Campo | Tipo | Descri√ß√£o |
|-----------|-------|------|-----------|
| OBJ-NNNN | NOME_CLIENTE | String | Nome retornado |

**Chamado Por**:

| ID Matriz | Fun√ß√£o Chamadora | Contexto |
|-----------|------------------|----------|
| METOD-0002 | CB2QP001 | Loop principal |

**Chama**:

| ID Matriz | Fun√ß√£o Chamada | Prop√≥sito |
|-----------|----------------|-----------|
| METOD-0015 | CB2QP010 | Validar dados |

**Comando para Ver Chamadores**:
```bash
.\vamap.exe _LEGADO/<programa>.esf --code "@<PROGRAMA>PNNN"
```

**Estruturas de Dados Utilizadas**:

| ID Matriz | Estrutura | Tipo Uso | Descri√ß√£o |
|-----------|-----------|----------|-----------|
| ENT-0001 | V1SISTEMA | Leitura | Consulta tabela |
| ENT-0002 | CB2QW001 | Leitura/Escrita | Workstorage |

**Opera√ß√µes SQL**:

Se aplic√°vel:

| ID Matriz | Tipo | SQL | Descri√ß√£o |
|-----------|------|-----|-----------|
| QUERY-0001 | SELECT | SELECT * FROM V1SISTEMA WHERE IDSISTEM = ? | Consulta sistema |

**Regras de Neg√≥cio Implementadas**:

#### [REGRA-NNNN] - Descri√ß√£o da Regra

**Rastreabilidade**:
- **ID Matriz**: `REGRA-NNNN`
- **Linha**: XXXX

**L√≥gica**:
```cobol
IF NUM_TITULO <> 0 THEN
    PERFORM CONSULTAR_TITULO
ELSE
    DISPLAY "T√≠tulo n√£o informado"
END-IF
```

**Tradu√ß√£o para L√≥gica Moderna**:
```csharp
// REGRA-NNNN: Valida√ß√£o de t√≠tulo informado
if (!string.IsNullOrEmpty(numeroTitulo))
{
    await ConsultarTitulo(numeroTitulo);
}
else
{
    throw new ValidationException("T√≠tulo n√£o informado");
}
```

**Condi√ß√µes**:
- Quando: Ap√≥s entrada do usu√°rio
- Se: Campo NUM_TITULO for diferente de zero/vazio
- Ent√£o: Executa consulta
- Sen√£o: Exibe mensagem de erro

**Exce√ß√µes/Erros Tratados**:

| ID Matriz | Condi√ß√£o | A√ß√£o | Mensagem |
|-----------|----------|------|----------|
| REGRA-NNNN | T√≠tulo vazio | Exibir erro | "T√≠tulo obrigat√≥rio" |

**Valida√ß√µes Realizadas**:

- `REGRA-NNNN`: Valida√ß√£o de campo obrigat√≥rio
- `REGRA-NNNN`: Valida√ß√£o de formato
- `REGRA-NNNN`: Valida√ß√£o de integridade referencial

**Fluxograma da Fun√ß√£o**:

```mermaid
flowchart TD
    Start([In√≠cio]) --> Input[Receber par√¢metros]
    Input --> Validate{REGRA-0007<br/>Validar entrada}
    Validate -->|V√°lido| Query[QUERY-0001<br/>Consultar DB]
    Validate -->|Inv√°lido| Error[Exibir erro E001]
    Query --> Check{Encontrou?}
    Check -->|Sim| Process[METOD-0015<br/>Processar resultado]
    Check -->|N√£o| Warning[Exibir aviso W001]
    Process --> End([Fim])
    Error --> End
    Warning --> End
```

**An√°lise de Complexidade**:

- **Complexidade Ciclom√°tica**: N (baseado em IFs/WHILEs)
- **Linhas de C√≥digo**: XXX
- **N√≠vel de Aninhamento**: N
- **Depend√™ncias**: N fun√ß√µes chamadas

**Comando para Analisar Comandos**:
```bash
# Contar IFs (complexidade)
.\vamap.exe _LEGADO/<programa>.esf --code ";IF" | grep "<PROGRAMA>PNNN"

# Contar WHILEs/LOOPs
.\vamap.exe _LEGADO/<programa>.esf --code ";WHILE" | grep "<PROGRAMA>PNNN"

# Ver atribui√ß√µes (MOVE)
.\vamap.exe _LEGADO/<programa>.esf --code ";MOVE" | grep "<PROGRAMA>PNNN"
```

## An√°lise de Regras de Neg√≥cio

### Comando de Identifica√ß√£o
```bash
# Ver todas valida√ß√µes
.\vamap.exe _LEGADO/<programa>.esf --code ";IF"

# Ver loops/itera√ß√µes
.\vamap.exe _LEGADO/<programa>.esf --code ";WHILE"

# Ver atribui√ß√µes
.\vamap.exe _LEGADO/<programa>.esf --code ";MOVE"
```

### Cat√°logo de Regras de Neg√≥cio

| ID Matriz | Descri√ß√£o | Fun√ß√£o | Linha | Criticidade |
|-----------|-----------|--------|-------|-------------|
| REGRA-0001 | Validar conex√£o DB2 | CB2QP000 | 3665 | Alta |
| REGRA-0007 | Validar t√≠tulo informado | CB2QP002 | 3817 | Alta |
| REGRA-0030 | Buscar ap√≥lice cobran√ßa | CB2QP005 | 4157 | M√©dia |

### Detalhamento de Regra

#### [REGRA-NNNN] - T√≠tulo da Regra

**Rastreabilidade**:
- **ID Matriz**: `REGRA-NNNN`
- **Fun√ß√£o**: `<PROGRAMA>PNNN`
- **Linha**: XXXX
- **Arquivo**: `_LEGADO/<programa>.esf`

**Descri√ß√£o**:
Descri√ß√£o detalhada da regra de neg√≥cio.

**Contexto de Aplica√ß√£o**:
- Quando √© aplicada
- Em que fun√ß√µes
- Em que telas

**C√≥digo COBOL**:
```cobol
[Trecho do c√≥digo COBOL]
```

**Tradu√ß√£o para L√≥gica Moderna**:
```csharp
// REGRA-NNNN
public async Task<Result> ValidateRule(Input input)
{
    // Implementa√ß√£o moderna
}
```

**Depend√™ncias**:
- Dados: `ENT-NNNN`
- Outras regras: `REGRA-NNNN`

**Casos de Teste**:

| Cen√°rio | Entrada | Sa√≠da Esperada |
|---------|---------|----------------|
| V√°lido | T√≠tulo = "123456" | Prosseguir |
| Inv√°lido | T√≠tulo = "" | Erro E001 |

## An√°lise de Tratamento de Erros

### Comando de Identifica√ß√£o
```bash
.\vamap.exe _LEGADO/<programa>.esf --code "#"
```

**Fun√ß√µes de Error Handling**:

| ID Matriz | Fun√ß√£o | Tipo Erro | A√ß√£o |
|-----------|--------|-----------|------|
| METOD-NNNN | CB2QE001 | SQL Error | Rollback e mensagem |
| METOD-NNNN | CB2QE002 | Valida√ß√£o | Exibir na tela |

## Calls Externos

### Identifica√ß√£o de CALLs

**Comando**:
```bash
.\vamap.exe _LEGADO/<programa>.esf --code ";CALL"
```

| ID Matriz | Fun√ß√£o | Programa Chamado | Prop√≥sito |
|-----------|--------|------------------|-----------|
| METOD-NNNN | CB2QP020 | CB2QR001 | Validar CPF |

## Matriz de Rastreabilidade de Regras

| ID Matriz | Regra | Fun√ß√£o | Tela | Dados | Tipo |
|-----------|-------|--------|------|-------|------|
| REGRA-0001 | Validar conex√£o | CB2QP000 | - | - | Sistema |
| REGRA-0007 | Validar t√≠tulo | CB2QP002 | CB2QM010 | V1SISTEMA | Neg√≥cio |
```

### 4.2 Comandos Obrigat√≥rios

Para an√°lise de fun√ß√µes e regras:

```bash
# 1. Invent√°rio completo de fun√ß√µes
.\vamap.exe _LEGADO/<programa>.esf --code "|"

# 2. Para cada fun√ß√£o, extrair c√≥digo
.\vamap.exe _LEGADO/<programa>.esf --code "<FUNCAO>"

# 3. Identificar chamadores
.\vamap.exe _LEGADO/<programa>.esf --code "@<FUNCAO>"

# 4. Ver posi√ß√£o no contexto
.\vamap.exe _LEGADO/<programa>.esf --code "!<FUNCAO>"

# 5. An√°lise de complexidade
.\vamap.exe _LEGADO/<programa>.esf --code ";IF"
.\vamap.exe _LEGADO/<programa>.esf --code ";WHILE"
.\vamap.exe _LEGADO/<programa>.esf --code ";MOVE"

# 6. Identificar tratamento de erros
.\vamap.exe _LEGADO/<programa>.esf --code "#"

# 7. Identificar valida√ß√µes
# Consultar: @commands/vamap-validation.md

# 8. Identificar CALLs externos
.\vamap.exe _LEGADO/<programa>.esf --code ";CALL"
```

### 4.3 Checklist de Documenta√ß√£o de Fun√ß√µes

- [ ] **OBRIGAT√ìRIO**: Invent√°rio completo de fun√ß√µes
- [ ] **OBRIGAT√ìRIO**: Cada fun√ß√£o tem ID na matriz (METOD-NNNN)
- [ ] **OBRIGAT√ìRIO**: Cada regra tem ID na matriz (REGRA-NNNN)
- [ ] **OBRIGAT√ìRIO**: C√≥digo fonte inclu√≠do para fun√ß√µes principais
- [ ] **OBRIGAT√ìRIO**: Fluxograma Mermaid por fun√ß√£o cr√≠tica
- [ ] Chamadores identificados
- [ ] Fun√ß√µes chamadas documentadas
- [ ] Estruturas de dados vinculadas
- [ ] Opera√ß√µes SQL identificadas
- [ ] Regras de neg√≥cio extra√≠das e catalogadas
- [ ] Valida√ß√µes documentadas
- [ ] Tratamento de erros mapeado
- [ ] CALLs externos identificados
- [ ] Complexidade ciclom√°tica calculada
- [ ] Tradu√ß√£o para l√≥gica moderna esbo√ßada
- [ ] Casos de teste sugeridos

---

## Processo de Atualiza√ß√£o da Matriz

### Fluxo Obrigat√≥rio

Ao concluir a documenta√ß√£o de cada elemento no documento AS-IS, seguir este fluxo:

#### 1. Durante a Documenta√ß√£o

Para cada elemento documentado:
- Anotar o **ID da Matriz** utilizado
- Anotar o **n√∫mero da linha inicial** onde foi documentado
- Anotar o **n√∫mero da linha final** onde termina a documenta√ß√£o

**Exemplo**:
```
Documentado: TELA-0001
Arquivo: 01_TELAS_INTERFACE.md
Linhas: 45-198
```

#### 2. Ao Final do Documento

Criar uma **lista completa de atualiza√ß√µes** a ser apresentada ao usu√°rio:

```markdown
## Resumo de Atualiza√ß√µes para Matriz

Os seguintes elementos foram documentados neste arquivo:

| ID Matriz | Elemento | Arquivo AS-IS | Linhas | Status Doc |
|-----------|----------|---------------|--------|------------|
| TELA-0001 | CB2QM010 | 01_TELAS_INTERFACE.md | 45-198 | OK |
| TELA-0002 | CB2QM020 | 01_TELAS_INTERFACE.md | 199-352 | OK |
| OBJ-0007 | NUM_TITULO | 01_TELAS_INTERFACE.md | 78 | OK |
| OBJ-0008 | NUM_APOLICE | 01_TELAS_INTERFACE.md | 79 | OK |
| ...

**Total**: XX elementos documentados

### Atualiza√ß√£o da Matriz

Deseja atualizar a `MATRIZ_RASTREABILIDADE.csv` com essas refer√™ncias?
- [ ] Sim, atualizar campos `Ref_Doc_AsIs`, `Ref_Doc_AsIs_Linhas` e `Status_Documentacao`
- [ ] N√£o, revisarei a documenta√ß√£o primeiro
```

#### 3. Aguardar Aprova√ß√£o do Usu√°rio

**CR√çTICO**: **NUNCA** atualizar a matriz sem aprova√ß√£o expl√≠cita do usu√°rio.

Aguardar uma das respostas:
- ‚úÖ **"Sim, pode atualizar"** ‚Üí Prosseguir com atualiza√ß√£o
- ‚ùå **"N√£o"** ou **"Vou revisar"** ‚Üí N√£o atualizar, usu√°rio revisar√° primeiro
- üîÑ **"Atualizar apenas X, Y, Z"** ‚Üí Atualizar apenas IDs especificados

#### 4. Executar Atualiza√ß√£o (Ap√≥s Aprova√ß√£o)

Para cada ID aprovado, atualizar na `MATRIZ_RASTREABILIDADE.csv`:

| Campo | Valor |
|-------|-------|
| `Ref_Doc_AsIs` | Nome do arquivo (ex: `01_TELAS_INTERFACE.md`) |
| `Ref_Doc_AsIs_Linhas` | Range de linhas (ex: `45-198`) ou linha √∫nica (ex: `78`) |
| `Status_Documentacao` | `OK` (se estava `NOK`) |

**Exemplo de Atualiza√ß√£o no CSV**:

Antes:
```csv
TELA-0001,TELA,,,CB2QM010 - Tela consulta,_LEGADO/cb2qa.esf,90,,,,,NOK,NOK,NA,,
```

Depois:
```csv
TELA-0001,TELA,,,CB2QM010 - Tela consulta,_LEGADO/cb2qa.esf,90,,,,,OK,NOK,NA,01_TELAS_INTERFACE.md,45-198
```

#### 5. Confirmar Atualiza√ß√£o

Apresentar resumo ao usu√°rio:

```markdown
‚úÖ Matriz Atualizada com Sucesso

Atualizados XX registros:
- TELA-0001: Ref_Doc_AsIs = 01_TELAS_INTERFACE.md, Linhas = 45-198
- TELA-0002: Ref_Doc_AsIs = 01_TELAS_INTERFACE.md, Linhas = 199-352
- ...

Status_Documentacao alterado para OK: XX registros
```

### Exemplo Completo de Fluxo

```
1. Documentar TELA-0001 em 01_TELAS_INTERFACE.md (linhas 45-198)
2. Documentar todos campos OBJ-0007 a OBJ-0016 (linhas 78-87)
3. Documentar REGRA-0001 a REGRA-0005 (linhas 150-180)

4. Ao final do arquivo, apresentar:
   "Deseja atualizar matriz com 15 elementos documentados?"

5. Usu√°rio responde: "Sim, pode atualizar"

6. Atualizar 15 linhas na MATRIZ_RASTREABILIDADE.csv

7. Confirmar: "‚úÖ 15 registros atualizados com sucesso"
```

### Comandos para Atualiza√ß√£o

**Verificar IDs antes de documentar**:
```bash
# Listar todos IDs de TELA
grep "^TELA-" MATRIZ_RASTREABILIDADE.csv

# Verificar status de documenta√ß√£o
grep "NOK" MATRIZ_RASTREABILIDADE.csv | grep "TELA"
```

**Ap√≥s aprova√ß√£o, atualizar matriz**:
```bash
# Exemplo de atualiza√ß√£o (usar ferramenta apropriada)
# Atualizar TELA-0001 com refer√™ncia ao documento
```

---

## Workflow de Documenta√ß√£o AS-IS

### Fase 1: Prepara√ß√£o (1 dia)

1. **Setup do Ambiente**
   - Instalar/validar vamap.exe
   - Criar estrutura de diret√≥rios docs/legado/asis/
   - Inicializar MATRIZ_RASTREABILIDADE.csv
   - Revisar @commands dispon√≠veis

2. **An√°lise Preliminar**
   ```bash
   # Executar comandos explorat√≥rios
   .\vamap.exe _LEGADO/<programa>.esf --code "|"
   .\vamap.exe _LEGADO/<programa>.esf --code "\"
   .\vamap.exe _LEGADO/<programa>.esf --map
   ```

3. **Planejamento**
   - Identificar escopo (quais programas documentar)
   - Definir prioridades (criticidade das fun√ß√µes)
   - Atribuir IDs iniciais na matriz

### Fase 2: Documenta√ß√£o de Telas (2-3 dias)

1. **Consultar Matriz**: Verificar IDs existentes tipo TELA, OBJ, FTELA, REGRA
2. Executar `/vamap-maps-list`
3. Para cada mapa:
   - Executar `/vamap-map`
   - Usar ID existente da matriz (ex: `TELA-0001`)
   - Documentar no `01_TELAS_INTERFACE.md`
   - Anotar linhas onde foi documentado
   - Criar diagrama de navega√ß√£o
4. Identificar fun√ß√µes de abertura (usar IDs METOD-NNNN)
5. Mapear campos e comportamentos (usar IDs OBJ-NNNN)
6. **Apresentar lista de atualiza√ß√µes ao usu√°rio**
7. **Aguardar aprova√ß√£o**
8. **Atualizar matriz** (campos `Ref_Doc_AsIs`, `Ref_Doc_AsIs_Linhas`, `Status_Documentacao`)

### Fase 3: Documenta√ß√£o de Dados (2-3 dias)

1. **Consultar Matriz**: Verificar IDs existentes tipo ENT, QUERY
2. Executar `/vamap-data`
3. Para cada estrutura:
   - Usar ID existente da matriz (ex: `ENT-0001`)
   - Executar `/vamap-data-detail`
   - Documentar no `02_MODELO_DADOS.md`
   - Anotar linhas onde foi documentado
4. Identificar opera√ß√µes SQL
   - `/vamap-inquiry`, `/vamap-setinq`, etc.
   - Usar IDs QUERY-NNNN existentes
   - Anotar linhas de documenta√ß√£o
5. Criar diagrama ER
6. **Apresentar lista de atualiza√ß√µes ao usu√°rio**
7. **Aguardar aprova√ß√£o**
8. **Atualizar matriz** (campos `Ref_Doc_AsIs`, `Ref_Doc_AsIs_Linhas`, `Status_Documentacao`)

### Fase 4: Documenta√ß√£o de Fluxo (3-4 dias)

1. **Consultar Matriz**: Verificar IDs existentes tipo METOD
2. Analisar stack completo (`/vamap-stack`)
3. Para cada fun√ß√£o importante:
   - Usar ID existente da matriz (ex: `METOD-0001`)
   - Executar `/vamap-function`
   - Identificar chamadores (`/vamap-callers`)
   - Documentar no `03_FLUXO_EXECUCAO.md`
   - Anotar linhas onde foi documentado
4. Criar diagramas de sequ√™ncia por caso de uso
5. Criar diagrama de componentes
6. **Apresentar lista de atualiza√ß√µes ao usu√°rio**
7. **Aguardar aprova√ß√£o**
8. **Atualizar matriz** (campos `Ref_Doc_AsIs`, `Ref_Doc_AsIs_Linhas`, `Status_Documentacao`)

### Fase 5: Documenta√ß√£o de Fun√ß√µes e Regras (4-5 dias)

1. **Consultar Matriz**: Verificar IDs existentes tipo METOD, REGRA
2. Para cada fun√ß√£o no stack:
   - Usar ID existente da matriz (ex: `METOD-0001`)
   - Extrair c√≥digo completo
   - Identificar regras de neg√≥cio (IFs, valida√ß√µes)
   - Usar IDs REGRA-NNNN existentes
   - Documentar no `04_FUNCOES_REGRAS_NEGOCIO.md`
   - Anotar linhas onde foi documentado
3. Analisar complexidade (`/vamap-commands ;IF`, etc.)
4. Identificar tratamento de erros (`/vamap-errors`)
5. Esbo√ßar tradu√ß√£o para l√≥gica moderna
6. **Apresentar lista de atualiza√ß√µes ao usu√°rio**
7. **Aguardar aprova√ß√£o**
8. **Atualizar matriz** (campos `Ref_Doc_AsIs`, `Ref_Doc_AsIs_Linhas`, `Status_Documentacao`)

### Fase 6: Revis√£o e Valida√ß√£o (2 dias)

1. **Valida√ß√£o de Completude**
   - [ ] Todos os 4 documentos criados em `docs/asis/`
   - [ ] **CR√çTICO**: Matriz atualizada com `Ref_Doc_AsIs` e `Ref_Doc_AsIs_Linhas` para todos elementos documentados
   - [ ] **CR√çTICO**: `Status_Documentacao=OK` para todos elementos documentados
   - [ ] Todos IDs referenciados existem na matriz
   - [ ] Outputs vamap inclu√≠dos

2. **Valida√ß√£o de Qualidade**
   - [ ] Diagramas Mermaid renderizam corretamente
   - [ ] Descri√ß√µes claras e precisas
   - [ ] Rastreabilidade completa (todos elementos t√™m ID da matriz)
   - [ ] Sem IDs duplicados

3. **Valida√ß√£o da Matriz**
   - [ ] Conferir campos `Ref_Doc_AsIs` preenchidos
   - [ ] Conferir campos `Ref_Doc_AsIs_Linhas` com ranges corretos
   - [ ] Conferir `Status_Documentacao=OK` onde aplic√°vel
   - [ ] Executar: `grep "01_TELAS_INTERFACE.md" MATRIZ_RASTREABILIDADE.csv`
   - [ ] Executar: `grep "02_MODELO_DADOS.md" MATRIZ_RASTREABILIDADE.csv`
   - [ ] Executar: `grep "03_FLUXO_EXECUCAO.md" MATRIZ_RASTREABILIDADE.csv`
   - [ ] Executar: `grep "04_FUNCOES_REGRAS_NEGOCIO.md" MATRIZ_RASTREABILIDADE.csv`

4. **Revis√£o por Stakeholders**
   - Arquitetos validam fluxos
   - Analistas de neg√≥cio validam regras
   - DBAs validam modelo de dados
   - UX valida telas

---

## Padr√µes de Qualidade

### Diagramas Mermaid

**SEMPRE** usar Mermaid para:
- Fluxos de navega√ß√£o (graph TD/LR)
- Diagramas de sequ√™ncia (sequenceDiagram)
- Diagramas ER (erDiagram)
- Fluxogramas de fun√ß√£o (flowchart TD)
- Diagramas de componentes (graph TB com subgraph)

**Exemplo de Qualidade**:

```mermaid
sequenceDiagram
    autonumber
    actor U as Usu√°rio
    participant T as TELA-0001<br/>CB2QM010
    participant F as METOD-0003<br/>CB2QP002
    participant Q as QUERY-0001<br/>INQUIRY
    participant D as ENT-0001<br/>V1SISTEMA
    
    Note over U,D: Caso de Uso: Consulta de Sistema
    
    U->>T: Digita IDSISTEM
    U->>T: Pressiona F5
    activate T
    T->>F: CONVERSE (dados)
    activate F
    
    Note over F: REGRA-0007<br/>Validar entrada
    
    F->>Q: Consultar sistema
    activate Q
    Q->>D: SELECT * WHERE ID=?
    activate D
    D-->>Q: Registro encontrado
    deactivate D
    Q-->>F: Sistema retornado
    deactivate Q
    
    F->>F: METOD-0015<br/>Processar resultado
    F-->>T: Dados processados
    deactivate F
    T-->>U: Exibe resultado
    deactivate T
```

### Tabelas de Mapeamento

**SEMPRE** incluir:
- Coluna ID Matriz
- Descri√ß√£o clara
- Tipos de dados
- Relacionamentos

### C√≥digo Extra√≠do

**SEMPRE** incluir:
- Comando vamap utilizado
- Output completo (n√£o resumir)
- Contexto (fun√ß√£o pai, linhas)

### Descri√ß√µes

**SEMPRE** escrever:
- Linguagem clara e objetiva
- Termos t√©cnicos explicados
- Contexto de neg√≥cio inclu√≠do
- Sem ambiguidades

---

## Integra√ß√£o com Outras Regras

Este documento **DEVE** ser usado em conjunto com:

- **legacy-matriz.mdc**: Regras de rastreabilidade
- **legacy-vamap.mdc**: Uso avan√ßado do vamap.exe
- **legacy-mapping-patterns.mdc**: Padr√µes de mapeamento legado ‚Üí moderno
- **@commands**: Comandos vamap dispon√≠veis
- **be-migration-doc-structure.mdc**: Estrutura de documenta√ß√£o de migra√ß√£o

### Sequ√™ncia de Uso

1. **Documenta√ß√£o AS-IS** (este documento)
   - Documentar situa√ß√£o atual completa
   - Criar matriz de rastreabilidade
   - Identificar todos elementos legados

2. **Mapeamento** (legacy-mapping-patterns.mdc)
   - Mapear legado ‚Üí moderno
   - Definir estrat√©gias de migra√ß√£o
   - Criar correspond√™ncias arquiteturais

3. **Documenta√ß√£o de Migra√ß√£o** (be-migration-doc-structure.mdc)
   - Criar 14 documentos de migra√ß√£o
   - Referenciar IDs da matriz
   - Implementar arquitetura moderna

---

## Checklist Geral de Documenta√ß√£o AS-IS

### Prepara√ß√£o
- [ ] vamap.exe instalado e funcionando
- [ ] Estrutura de diret√≥rios criada: `docs/asis/`
- [ ] **CR√çTICO**: `MATRIZ_RASTREABILIDADE.csv` dispon√≠vel e atualizada
- [ ] **CR√çTICO**: IDs da matriz identificados (TELA, METOD, ENT, OBJ, QUERY, REGRA, FTELA)
- [ ] @commands revisados

### Documento 01 - Telas e Interface
- [ ] **OBRIGAT√ìRIO**: Consultar matriz antes de iniciar
- [ ] **OBRIGAT√ìRIO**: Invent√°rio completo de mapas
- [ ] **OBRIGAT√ìRIO**: Todos mapas t√™m ID da matriz (TELA-NNNN)
- [ ] **OBRIGAT√ìRIO**: Layout visual inclu√≠do (vamap output)
- [ ] **OBRIGAT√ìRIO**: Campos mapeados com IDs da matriz (OBJ-NNNN)
- [ ] **OBRIGAT√ìRIO**: Teclas de fun√ß√£o com IDs da matriz (REGRA-NNNN)
- [ ] **OBRIGAT√ìRIO**: Linhas anotadas para cada elemento documentado
- [ ] **OBRIGAT√ìRIO**: Lista de atualiza√ß√µes apresentada ao usu√°rio
- [ ] **OBRIGAT√ìRIO**: Aprova√ß√£o do usu√°rio obtida
- [ ] **OBRIGAT√ìRIO**: Matriz atualizada (Ref_Doc_AsIs, Ref_Doc_AsIs_Linhas, Status_Documentacao)
- [ ] Diagramas de navega√ß√£o criados
- [ ] Comportamentos documentados
- [ ] Valida√ß√µes identificadas

### Documento 02 - Modelo de Dados
- [ ] **OBRIGAT√ìRIO**: Consultar matriz antes de iniciar
- [ ] **OBRIGAT√ìRIO**: Invent√°rio completo de estruturas
- [ ] **OBRIGAT√ìRIO**: Tabelas DB2 identificadas com IDs da matriz (ENT-NNNN)
- [ ] **OBRIGAT√ìRIO**: Records documentados com IDs da matriz
- [ ] **OBRIGAT√ìRIO**: Opera√ß√µes SQL mapeadas com IDs da matriz (QUERY-NNNN)
- [ ] **OBRIGAT√ìRIO**: Linhas anotadas para cada elemento documentado
- [ ] **OBRIGAT√ìRIO**: Lista de atualiza√ß√µes apresentada ao usu√°rio
- [ ] **OBRIGAT√ìRIO**: Aprova√ß√£o do usu√°rio obtida
- [ ] **OBRIGAT√ìRIO**: Matriz atualizada (Ref_Doc_AsIs, Ref_Doc_AsIs_Linhas, Status_Documentacao)
- [ ] Diagrama ER criado
- [ ] Relacionamentos identificados
- [ ] √çndices documentados

### Documento 03 - Fluxo de Execu√ß√£o
- [ ] **OBRIGAT√ìRIO**: Consultar matriz antes de iniciar
- [ ] **OBRIGAT√ìRIO**: Stack completo extra√≠do
- [ ] **OBRIGAT√ìRIO**: Fun√ß√µes principais identificadas com IDs da matriz (METOD-NNNN)
- [ ] **OBRIGAT√ìRIO**: Diagrama de hierarquia criado
- [ ] **OBRIGAT√ìRIO**: Linhas anotadas para cada elemento documentado
- [ ] **OBRIGAT√ìRIO**: Lista de atualiza√ß√µes apresentada ao usu√°rio
- [ ] **OBRIGAT√ìRIO**: Aprova√ß√£o do usu√°rio obtida
- [ ] **OBRIGAT√ìRIO**: Matriz atualizada (Ref_Doc_AsIs, Ref_Doc_AsIs_Linhas, Status_Documentacao)
- [ ] Diagramas de sequ√™ncia por caso de uso
- [ ] Diagrama de componentes
- [ ] Matriz de depend√™ncias

### Documento 04 - Fun√ß√µes e Regras
- [ ] **OBRIGAT√ìRIO**: Consultar matriz antes de iniciar
- [ ] **OBRIGAT√ìRIO**: Todas fun√ß√µes documentadas com IDs da matriz (METOD-NNNN)
- [ ] **OBRIGAT√ìRIO**: Regras de neg√≥cio extra√≠das com IDs da matriz (REGRA-NNNN)
- [ ] **OBRIGAT√ìRIO**: C√≥digo fonte inclu√≠do
- [ ] **OBRIGAT√ìRIO**: Linhas anotadas para cada elemento documentado
- [ ] **OBRIGAT√ìRIO**: Lista de atualiza√ß√µes apresentada ao usu√°rio
- [ ] **OBRIGAT√ìRIO**: Aprova√ß√£o do usu√°rio obtida
- [ ] **OBRIGAT√ìRIO**: Matriz atualizada (Ref_Doc_AsIs, Ref_Doc_AsIs_Linhas, Status_Documentacao)
- [ ] Fluxogramas por fun√ß√£o cr√≠tica
- [ ] Chamadores identificados
- [ ] Complexidade calculada
- [ ] Tradu√ß√£o moderna esbo√ßada

### Qualidade
- [ ] **OBRIGAT√ìRIO**: Todos IDs na matriz existem
- [ ] **OBRIGAT√ìRIO**: Nenhum ID duplicado
- [ ] **OBRIGAT√ìRIO**: Outputs vamap completos inclu√≠dos
- [ ] **OBRIGAT√ìRIO**: Diagramas Mermaid renderizam
- [ ] Descri√ß√µes claras e precisas
- [ ] Rastreabilidade 100% completa
- [ ] Revis√£o por stakeholders aprovada

### Matriz de Rastreabilidade
- [ ] **OBRIGAT√ìRIO**: Todas TELAS cadastradas com IDs
- [ ] **OBRIGAT√ìRIO**: Todos METODOS cadastrados com IDs
- [ ] **OBRIGAT√ìRIO**: Todas ENTIDADES cadastradas com IDs
- [ ] **OBRIGAT√ìRIO**: Todos OBJETOS/campos cadastrados com IDs
- [ ] **OBRIGAT√ìRIO**: Todas REGRAS cadastradas com IDs
- [ ] **OBRIGAT√ìRIO**: Todas QUERIES cadastradas com IDs
- [ ] **OBRIGAT√ìRIO**: Todas FTELAS cadastradas com IDs
- [ ] **OBRIGAT√ìRIO**: Campo `Ref_Doc_AsIs` preenchido para elementos documentados
- [ ] **OBRIGAT√ìRIO**: Campo `Ref_Doc_AsIs_Linhas` preenchido para elementos documentados
- [ ] **OBRIGAT√ìRIO**: `Status_Documentacao = OK` para elementos finalizados
- [ ] Nenhum elemento documentado sem refer√™ncia na matriz
- [ ] Validar: `grep "OK.*01_TELAS" MATRIZ_RASTREABILIDADE.csv` retorna registros
- [ ] Validar: `grep "OK.*02_MODELO" MATRIZ_RASTREABILIDADE.csv` retorna registros
- [ ] Validar: `grep "OK.*03_FLUXO" MATRIZ_RASTREABILIDADE.csv` retorna registros
- [ ] Validar: `grep "OK.*04_FUNCOES" MATRIZ_RASTREABILIDADE.csv` retorna registros

---

## Exemplo Pr√°tico Completo: Documenta√ß√£o com Atualiza√ß√£o da Matriz

### Cen√°rio: Documentar Tela CB2QM010

#### Passo 1: Consultar Matriz

```bash
# Verificar se tela j√° tem ID cadastrado
grep "CB2QM010" MATRIZ_RASTREABILIDADE.csv
```

**Resultado**:
```csv
TELA-0001,TELA,,,CB2QM010 - Tela consulta movto debito automatico,_LEGADO/cb2qa.esf,90,,,,,NOK,NOK,NA,,
```

‚úÖ ID encontrado: `TELA-0001`

#### Passo 2: Verificar Campos Relacionados

```bash
# Buscar campos da tela
grep "CB2QM010.*TELA" MATRIZ_RASTREABILIDADE.csv | grep "OBJ-"
```

**Resultado**: IDs de OBJ-0007 a OBJ-0016

#### Passo 3: Executar vamap

```bash
.\vamap.exe _LEGADO/cb2qa.esf --map "CB2QM010"
```

#### Passo 4: Documentar em 01_TELAS_INTERFACE.md

```markdown
### [TELA-0001] - CB2QM010 - Tela Consulta Movimento D√©bito Autom√°tico

**Rastreabilidade** (ID da MATRIZ_RASTREABILIDADE.csv):
- **ID Matriz**: `TELA-0001`
- **Descri√ß√£o**: CB2QM010 - Tela consulta movto debito automatico
- **Arquivo Legado**: `_LEGADO/cb2qa.esf`
- **Linha**: 90

[... conte√∫do da documenta√ß√£o ...]

| ID Matriz | Campo Mapa | Label | ...
|-----------|------------|-------|---
| OBJ-0007 | NUM_TITULO | Numero titulo | ...
| OBJ-0008 | NUM_APOLICE | Numero apolice | ...
```

**Linhas**: 45-198 (anotar!)

#### Passo 5: Ao Final do Documento

Criar se√ß√£o de resumo:

```markdown
---

## Resumo de Atualiza√ß√µes para Matriz

Os seguintes elementos foram documentados neste arquivo:

| ID Matriz | Elemento | Descri√ß√£o | Linhas |
|-----------|----------|-----------|--------|
| TELA-0001 | CB2QM010 | Tela consulta | 45-198 |
| TELA-0002 | CB2QM020 | Tela listagem | 199-352 |
| OBJ-0007 | NUM_TITULO | Campo titulo | 78 |
| OBJ-0008 | NUM_APOLICE | Campo apolice | 79 |
| OBJ-0009 | NRENDOS | Campo endosso | 80 |
| REGRA-0001 | IF EZEAID=PF3 | Tecla F3 | 165 |
| REGRA-0003 | IF EZEAID=PF12 | Tecla F12 | 167 |

**Total**: 7 elementos documentados

### ‚ö†Ô∏è Atualiza√ß√£o da Matriz Necess√°ria

Deseja atualizar a `MATRIZ_RASTREABILIDADE.csv` com essas refer√™ncias?

**Campos a atualizar**:
- `Ref_Doc_AsIs` = `01_TELAS_INTERFACE.md`
- `Ref_Doc_AsIs_Linhas` = conforme tabela acima
- `Status_Documentacao` = `OK`

**Aguardando aprova√ß√£o do usu√°rio...**
```

#### Passo 6: Usu√°rio Responde

```
Usu√°rio: "Sim, pode atualizar a matriz"
```

#### Passo 7: Atualizar Matriz

**Antes** (TELA-0001):
```csv
TELA-0001,TELA,,,CB2QM010 - Tela consulta movto debito automatico,_LEGADO/cb2qa.esf,90,,,,,NOK,NOK,NA,,
```

**Depois** (TELA-0001):
```csv
TELA-0001,TELA,,,CB2QM010 - Tela consulta movto debito automatico,_LEGADO/cb2qa.esf,90,,,,,OK,NOK,NA,01_TELAS_INTERFACE.md,45-198
```

**Antes** (OBJ-0007):
```csv
OBJ-0007,OBJETO,CB2QM010,TELA,NUM_TITULO - Numero titulo (foco inicial),_LEGADO/cb2qa.esf,228,,,,,NOK,NOK,NA,,
```

**Depois** (OBJ-0007):
```csv
OBJ-0007,OBJETO,CB2QM010,TELA,NUM_TITULO - Numero titulo (foco inicial),_LEGADO/cb2qa.esf,228,,,,,OK,NOK,NA,01_TELAS_INTERFACE.md,78
```

#### Passo 8: Confirmar ao Usu√°rio

```markdown
‚úÖ Matriz Atualizada com Sucesso

Atualizados 7 registros em MATRIZ_RASTREABILIDADE.csv:

- TELA-0001: Ref_Doc_AsIs = 01_TELAS_INTERFACE.md, Linhas = 45-198
- TELA-0002: Ref_Doc_AsIs = 01_TELAS_INTERFACE.md, Linhas = 199-352
- OBJ-0007: Ref_Doc_AsIs = 01_TELAS_INTERFACE.md, Linhas = 78
- OBJ-0008: Ref_Doc_AsIs = 01_TELAS_INTERFACE.md, Linhas = 79
- OBJ-0009: Ref_Doc_AsIs = 01_TELAS_INTERFACE.md, Linhas = 80
- REGRA-0001: Ref_Doc_AsIs = 01_TELAS_INTERFACE.md, Linhas = 165
- REGRA-0003: Ref_Doc_AsIs = 01_TELAS_INTERFACE.md, Linhas = 167

Status_Documentacao alterado para OK: 7 registros

‚úÖ Documenta√ß√£o AS-IS conclu√≠da e rastreada na matriz!
```

---

## Refer√™ncias R√°pidas

### Comandos vamap.exe Essenciais

```bash
# Invent√°rios
.\vamap.exe <programa>.esf --code "|"          # Stack completo
.\vamap.exe <programa>.esf --code "\"          # Todas estruturas
.\vamap.exe <programa>.esf --map               # Todos mapas

# Detalhamentos
.\vamap.exe <programa>.esf --code "<FUNCAO>"   # C√≥digo da fun√ß√£o
.\vamap.exe <programa>.esf --code "<TABELA>\"  # Detalhes da estrutura
.\vamap.exe <programa>.esf --map "<MAPA>"      # Layout da tela

# An√°lises
.\vamap.exe <programa>.esf --code "@<FUNCAO>"  # Quem chama
.\vamap.exe <programa>.esf --code "!<FUNCAO>"  # Posi√ß√£o no stack
.\vamap.exe <programa>.esf --code "#"          # Error handlers

# Tipos
.\vamap.exe <programa>.esf --code ":inquiry"   # SELECT √∫nico
.\vamap.exe <programa>.esf --code ":setinq"    # SELECT m√∫ltiplo
.\vamap.exe <programa>.esf --code ":converse"  # Interface
.\vamap.exe <programa>.esf --code ":execute"   # L√≥gica

# Comandos
.\vamap.exe <programa>.esf --code ";IF"        # Condicionais
.\vamap.exe <programa>.esf --code ";MOVE"      # Atribui√ß√µes
.\vamap.exe <programa>.esf --code ";CALL"      # Chamadas externas
```

### Consulta R√°pida a @commands

- `/vamap-stack` - Pilha de execu√ß√£o
- `/vamap-function` - C√≥digo de fun√ß√£o
- `/vamap-map` - Layout de tela
- `/vamap-data` - Estruturas de dados
- `/vamap-flow` - Fluxo completo
- `/vamap-migration-plan` - Plano de migra√ß√£o

Consultar: `@commands/README.md` para lista completa.

---

## ‚ö†Ô∏è Pontos Cr√≠ticos - LEIA ANTES DE DOCUMENTAR

### 1. Estrutura de Pastas

‚úÖ **CORRETO**: `docs/asis/01_TELAS_INTERFACE.md`  
‚ùå **ERRADO**: `docs/legado/asis/01_TELAS_INTERFACE.md`

### 2. Uso da Matriz

‚úÖ **SEMPRE**:
- Consultar `MATRIZ_RASTREABILIDADE.csv` **ANTES** de iniciar documenta√ß√£o
- Usar IDs **EXISTENTES** na matriz (TELA-0001, METOD-0011, etc.)
- Anotar **linhas** onde cada elemento foi documentado
- Referenciar IDs em **TODA** documenta√ß√£o

‚ùå **NUNCA**:
- Criar novos IDs sem verificar a matriz
- Documentar sem anotar linhas
- Omitir IDs da matriz na documenta√ß√£o

### 3. Atualiza√ß√£o da Matriz

‚úÖ **OBRIGAT√ìRIO**:
1. Ao final de cada documento, criar **lista de atualiza√ß√µes**
2. **APRESENTAR** lista ao usu√°rio
3. **AGUARDAR** aprova√ß√£o expl√≠cita
4. **ATUALIZAR** campos: `Ref_Doc_AsIs`, `Ref_Doc_AsIs_Linhas`, `Status_Documentacao`
5. **CONFIRMAR** ao usu√°rio que matriz foi atualizada

‚ùå **PROIBIDO**:
- Atualizar matriz sem aprova√ß√£o do usu√°rio
- Pular etapa de apresenta√ß√£o de lista
- Atualizar campos incorretos

### 4. Campos da Matriz

| Campo | Quando Atualizar | Valor | Exemplo |
|-------|------------------|-------|---------|
| `Ref_Doc_AsIs` | Ap√≥s aprova√ß√£o | Nome do arquivo AS-IS | `01_TELAS_INTERFACE.md` |
| `Ref_Doc_AsIs_Linhas` | Ap√≥s aprova√ß√£o | Range ou linha √∫nica | `45-198` ou `78` |
| `Status_Documentacao` | Ap√≥s documentar | `OK` (estava `NOK`) | `OK` |

### 5. Valida√ß√£o Final

Antes de considerar documenta√ß√£o AS-IS completa, executar:

```bash
# Verificar elementos documentados em cada arquivo
grep "OK.*01_TELAS_INTERFACE" MATRIZ_RASTREABILIDADE.csv | wc -l
grep "OK.*02_MODELO_DADOS" MATRIZ_RASTREABILIDADE.csv | wc -l
grep "OK.*03_FLUXO_EXECUCAO" MATRIZ_RASTREABILIDADE.csv | wc -l
grep "OK.*04_FUNCOES_REGRAS_NEGOCIO" MATRIZ_RASTREABILIDADE.csv | wc -l

# Verificar elementos sem documenta√ß√£o AS-IS
grep "NOK.*NOK.*NA,," MATRIZ_RASTREABILIDADE.csv
```

### 6. Fluxo Resumido

```
1. Consultar MATRIZ ‚Üí Identificar IDs
2. Documentar ‚Üí Anotar linhas
3. Criar lista ‚Üí Apresentar ao usu√°rio
4. Aguardar ‚Üí Obter aprova√ß√£o
5. Atualizar ‚Üí Ref_Doc_AsIs + Ref_Doc_AsIs_Linhas + Status_Documentacao
6. Confirmar ‚Üí Informar usu√°rio
```

---

**Vers√£o**: 2.0  
**√öltima atualiza√ß√£o**: Dezembro 2024  
**Status**: ATIVO  
**Mudan√ßas**: 
- v2.0: Adicionado processo de atualiza√ß√£o da matriz com aprova√ß√£o do usu√°rio
- v2.0: Alterada pasta de `docs/legado/asis` para `docs/asis`
- v2.0: Adicionados campos `Ref_Doc_AsIs` e `Ref_Doc_AsIs_Linhas`
